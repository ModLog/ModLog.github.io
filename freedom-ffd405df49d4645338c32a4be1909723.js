!function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n?n:e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){t.exports=[{name:"console",api:{log:{type:"method",value:["string","string"]},debug:{type:"method",value:["string","string"]},info:{type:"method",value:["string","string"]},warn:{type:"method",value:["string","string"]},error:{type:"method",value:["string","string"]}}},{name:"core.console",api:{log:{type:"method",value:["string","string"]},debug:{type:"method",value:["string","string"]},info:{type:"method",value:["string","string"]},warn:{type:"method",value:["string","string"]},error:{type:"method",value:["string","string"]}}},{name:"core.echo",api:{setup:{type:"method",value:["string"]},send:{type:"method",value:["string"]},message:{type:"event",value:"string"}}},{name:"core",api:{createChannel:{type:"method",value:[],ret:{channel:"proxy",identifier:"string"}},bindChannel:{type:"method",value:["string"],ret:"proxy"},getId:{type:"method",value:[],ret:["array","string"]},getLogger:{type:"method",value:["string"],ret:"proxy"}}},{name:"core.oauth",api:{initiateOAuth:{type:"method",value:[["array","string"]],ret:{redirect:"string",state:"string"},err:{errcode:"string",message:"string"}},launchAuthFlow:{type:"method",value:["string",{redirect:"string",state:"string"}],ret:"string",err:{errcode:"string",message:"string"}}}},{name:"core.peerconnection",api:{setup:{type:"method",value:["string","string",["array","string"],"boolean"]},send:{type:"method",value:[{channelLabel:"string",text:"string",binary:"blob",buffer:"buffer"}]},onReceived:{type:"event",value:{channelLabel:"string",text:"string",binary:"blob",buffer:"buffer"}},openDataChannel:{type:"method",value:["string"]},closeDataChannel:{type:"method",value:["string"]},onOpenDataChannel:{type:"event",value:{channelId:"string"}},onCloseDataChannel:{type:"event",value:{channelId:"string"}},getBufferedAmount:{type:"method",value:["string"],ret:"number"},getInfo:{type:"method",value:[],ret:"string"},createOffer:{type:"method",value:[{offerToReceiveVideo:"number",offerToReceiveAudio:"number",voiceActivityDetection:"boolean",iceRestart:"boolean"}],ret:{type:"string",sdp:"string"}},close:{type:"method",value:[]},onClose:{type:"event",value:{}}}},{name:"core.rtcdatachannel",api:{constructor:{value:["string"]},getLabel:{type:"method",value:[],ret:"string"},getOrdered:{type:"method",value:[],ret:"boolean"},getMaxPacketLifeTime:{type:"method",value:[],ret:"number"},getMaxRetransmits:{type:"method",value:[],ret:"number"},getProtocol:{type:"method",value:[],ret:"string"},getNegotiated:{type:"method",value:[],ret:"boolean"},getId:{type:"method",value:[],ret:"number"},getReadyState:{type:"method",value:[],ret:"string"},getBufferedAmount:{type:"method",value:[],ret:"number"},onopen:{type:"event",value:[]},onerror:{type:"event",value:[]},onclose:{type:"event",value:[]},close:{type:"method",value:[]},onmessage:{type:"event",value:{text:"string",buffer:"buffer"}},getBinaryType:{type:"method",value:[],ret:"string"},setBinaryType:{type:"method",value:["string"]},send:{type:"method",value:["string"]},sendBuffer:{type:"method",value:["buffer"]}}},{name:"core.rtcpeerconnection",api:{constructor:{value:[{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}]},createOffer:{type:"method",value:[{offerToReceiveAudio:"number",offerToReceiveVideo:"number",iceRestart:"boolean",voiceActivityDetection:"boolean"}],ret:{type:"string",sdp:"string"}},createAnswer:{type:"method",value:[],ret:{type:"string",sdp:"string"}},setLocalDescription:{type:"method",value:[{type:"string",sdp:"string"}]},getLocalDescription:{type:"method",value:[],ret:{type:"string",sdp:"string"}},setRemoteDescription:{type:"method",value:[{type:"string",sdp:"string"}],ret:{}},getRemoteDescription:{type:"method",value:[],ret:{type:"string",sdp:"string"}},getSignalingState:{type:"method",value:[],ret:"string"},updateIce:{type:"method",value:[{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}],ret:{}},addIceCandidate:{type:"method",value:[{candidate:"string",sdpMid:"string",sdpMLineIndex:"number"}],ret:{}},getIceGatheringState:{type:"method",value:[],ret:"string"},getIceConnectionState:{type:"method",value:[],ret:"string"},getConfiguration:{type:"method",value:[],ret:{iceServers:["array",{urls:["array","string"],username:"string",credential:"string"}],iceTransports:"string",peerIdentity:"string"}},getLocalStreams:{type:"method",value:[],ret:["array","string"]},getRemoteStreams:{type:"method",value:[],ret:["array","string"]},getStreamById:{type:"method",value:["string"],ret:"string"},addStream:{type:"method",value:["string"],ret:{}},removeStream:{type:"method",value:["string"],ret:{}},close:{type:"method",value:[],ret:{}},createDataChannel:{type:"method",value:["string",{ordered:"boolean",maxPacketLifeTime:"number",maxRetransmits:"number",protocol:"string",negotiated:"boolean",id:"number"}],ret:"string"},ondatachannel:{type:"event",value:{channel:"string"}},getStats:{type:"method",value:["string"],ret:"object"},onnegotiationneeded:{type:"event",value:[]},onicecandidate:{type:"event",value:{candidate:{candidate:"string",sdpMid:"string",sdpMLineIndex:"number"}}},onsignalingstatechange:{type:"event",value:[]},onaddstream:{type:"event",value:{stream:"number"}},onremovestream:{type:"event",value:{stream:"number"}},oniceconnectionstatechange:{type:"event",value:[]}}},{name:"core.storage",api:{keys:{type:"method",value:[],ret:["array","string"]},get:{type:"method",value:["string"],ret:"string"},set:{type:"method",value:["string","string"],ret:"string"},remove:{type:"method",value:["string"],ret:"string"},clear:{type:"method",value:[]}}},{name:"core.tcpsocket",api:{constructor:{value:["number"]},getInfo:{type:"method",value:[],ret:{connected:"boolean",localAddress:"string",localPort:"number",peerAddress:"string",peerPort:"number"}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",ALREADY_CONNECTED:"Socket already connected",INVALID_ARGUMENT:"Invalid argument",TIMED_OUT:"Timed out",NOT_CONNECTED:"Socket not connected",NETWORK_CHANGED:"Network changed",CONNECTION_CLOSED:"Connection closed gracefully",CONNECTION_RESET:"Connection reset",CONNECTION_REFUSED:"Connection refused",CONNECTION_FAILED:"Connection failed",NAME_NOT_RESOLVED:"DNS lookup failed",INTERNET_DISCONNECTED:"Cannot reach any network",ADDRESS_INVALID:"Invalid address",ADDRESS_UNREACHABLE:"No route to host",HOST_UNREACHABLE:"SOCKS proxy server could not reach host"}},close:{type:"method",value:[],err:{errcode:"string",message:"string"}},onDisconnect:{type:"event",value:{errcode:"string",message:"string"}},connect:{type:"method",value:["string","number"],err:{errcode:"string",message:"string"}},secure:{type:"method",value:[],err:{errcode:"string",message:"string"}},pause:{type:"method",value:[],err:{errcode:"string",message:"string"}},resume:{type:"method",value:[],err:{errcode:"string",message:"string"}},prepareSecure:{type:"method",value:[],err:{errcode:"string",message:"string"}},write:{type:"method",value:["buffer"],err:{errcode:"string",message:"string"}},onData:{type:"event",value:{data:"buffer"}},listen:{type:"method",value:["string","number"],err:{errcode:"string",message:"string"}},onConnection:{type:"event",value:{socket:"number",host:"string",port:"number"}}}},{name:"core.udpsocket",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",ALREADY_BOUND:"Socket already bound",INVALID_ARGUMENT:"Invalid argument",NETWORK_CHANGED:"Network changed",SNED_FAILED:"Send failed"}},bind:{type:"method",value:["string","number"],ret:[],err:{errcode:"string",message:"string"}},getInfo:{type:"method",value:[],ret:{localAddress:"string",localPort:"number"}},sendTo:{type:"method",value:["buffer","string","number"],ret:"number",err:{errcode:"string",message:"string"}},destroy:{type:"method",value:[]},onData:{type:"event",value:{resultCode:"number",address:"string",port:"number",data:"buffer"}}}},{name:"core.view",api:{show:{type:"method",value:["string"]},isSecure:{type:"method",value:[],ret:"boolean"},close:{type:"method",value:[]},postMessage:{type:"method",value:["object"]},message:{type:"event",value:"object"},onClose:{type:"event",value:[]}}},{name:"core.websocket",api:{constructor:{value:["string",["array","string"]]},send:{type:"method",value:[{text:"string",binary:"blob",buffer:"buffer"}],err:{errcode:"string",message:"string"}},getReadyState:{type:"method",value:[],ret:"number"},getBufferedAmount:{type:"method",value:["string"],ret:"number"},close:{type:"method",value:["number","string"],err:{errcode:"string",message:"string"}},onMessage:{type:"event",value:{text:"string",binary:"blob",buffer:"buffer"}},onOpen:{type:"event",value:[]},onError:{type:"event",value:{errcode:"string",message:"string"}},onClose:{type:"event",value:{code:"number",reason:"string",wasClean:"boolean"}}}},{name:"core.xhr",api:{open:{type:"method",value:["string","string","boolean","string","string"],err:{errcode:"string",message:"string"}},send:{type:"method",value:[{string:"string",buffer:"buffer"}]},abort:{type:"method",value:[]},getResponseHeader:{type:"method",value:["string"],ret:"string"},getAllResponseHeaders:{type:"method",value:[],ret:"string"},setRequestHeader:{type:"method",value:["string","string"]},overrideMimeType:{type:"method",value:["string"]},getReadyState:{type:"method",value:[],ret:"number"},getResponse:{type:"method",value:[],ret:{string:"string",buffer:"buffer",object:"object"}},getResponseText:{type:"method",value:[],ret:"string"},getResponseURL:{type:"method",value:[],ret:"string"},getResponseType:{type:"method",value:[],ret:"string"},setResponseType:{type:"method",value:["string"]},getStatus:{type:"method",value:[],ret:"number"},getStatusText:{type:"method",value:[],ret:"string"},getTimeout:{type:"method",value:[],ret:"number"},setTimeout:{type:"method",value:["number"]},getWithCredentials:{type:"method",value:[],ret:"boolean"},setWithCredentials:{type:"method",value:["boolean"]},onloadstart:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onprogress:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onabort:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onerror:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onload:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},ontimeout:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onloadend:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onreadystatechange:{type:"event",value:{}},onuploadloadstart:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadprogress:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadabort:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploaderror:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadload:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadtimeout:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadloadend:{type:"event",value:{lengthComputable:"boolean",loaded:"number",total:"number"}},onuploadreadystatechange:{type:"event",value:{}}}},{name:"social",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"User is currently offline",MALFORMEDPARAMETERS:"Parameters are malformed",LOGIN_BADCREDENTIALS:"Error authenticating with server",LOGIN_FAILEDCONNECTION:"Error connecting to server",LOGIN_ALREADYONLINE:"User is already logged in",LOGIN_OAUTHERROR:"OAuth Error",SEND_INVALIDDESTINATION:"Message sent to an invalid destination"}},STATUS:{type:"constant",value:{OFFLINE:"OFFLINE",ONLINE:"ONLINE",ONLINE_WITH_OTHER_APP:"ONLINE_WITH_OTHER_APP"}},login:{type:"method",value:[{agent:"string",version:"string",url:"string",interactive:"boolean",rememberLogin:"boolean"}],ret:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"},err:{errcode:"string",message:"string"}},clearCachedCredentials:{type:"method",value:[]},getClients:{type:"method",value:[],ret:"object",err:{errcode:"string",message:"string"}},getUsers:{type:"method",value:[],ret:"object",err:{errcode:"string",message:"string"}},sendMessage:{type:"method",value:["string","string"],err:{errcode:"string",message:"string"}},logout:{type:"method",value:[],err:{errcode:"string",message:"string"}},onMessage:{type:"event",value:{from:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"},message:"string"}},onUserProfile:{type:"event",value:{userId:"string",lastUpdated:"number",name:"string",url:"string",imageData:"string"}},onClientState:{type:"event",value:{userId:"string",clientId:"string",status:"string",lastUpdated:"number",lastSeen:"number"}}}},{name:"storage",api:{scope:{type:"constant",value:{SESSION:0,DEVICE_LOCAL:1,USER_LOCAL:2,SHARED:3}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Database not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},constructor:{value:[{scope:"number"}]},keys:{type:"method",value:[],ret:["array","string"],err:{errcode:"string",message:"string"}},get:{type:"method",value:["string"],ret:"string",err:{errcode:"string",message:"string"}},set:{type:"method",value:["string","string"],ret:"string",err:{errcode:"string",message:"string"}},remove:{type:"method",value:["string"],ret:"string",err:{errcode:"string",message:"string"}},clear:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}}}},{name:"storebuffer",api:{scope:{type:"constant",value:{SESSION:0,DEVICE_LOCAL:1,USER_LOCAL:2,SHARED:3}},ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Database not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},constructor:{value:[{scope:"number"}]},keys:{type:"method",value:[],ret:["array","string"],err:{errcode:"string",message:"string"}},get:{type:"method",value:["string"],ret:"buffer",err:{errcode:"string",message:"string"}},set:{type:"method",value:["string","buffer"],ret:"buffer",err:{errcode:"string",message:"string"}},remove:{type:"method",value:["string"],ret:"buffer",err:{errcode:"string",message:"string"}},clear:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}}}},{name:"transport",api:{ERRCODE:{type:"constant",value:{SUCCESS:"Success!",UNKNOWN:"Unknown error",OFFLINE:"Not reachable",MALFORMEDPARAMETERS:"Parameters are malformed"}},setup:{type:"method",value:["string","proxy"],ret:[],err:{errcode:"string",message:"string"}},send:{type:"method",value:["string","buffer"],ret:[],err:{errcode:"string",message:"string"}},close:{type:"method",value:[],ret:[],err:{errcode:"string",message:"string"}},onData:{type:"event",value:{tag:"string",data:"buffer"}},onClose:{type:"event",value:[]}}}]},{}],2:[function(e,t,n){(function(e,n){(function(){"use strict";function i(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function s(){}function a(){return function(){e.nextTick(l)}}function c(){var e=0,t=new q(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function h(){var e=new MessageChannel;return e.port1.onmessage=l,function(){e.port2.postMessage(0)}}function d(){return function(){setTimeout(l,1)}}function l(){for(var e=0;F>e;e+=2){var t=H[e],n=H[e+1];t(n),H[e]=void 0,H[e+1]=void 0}F=0}function u(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return V.error=t,V}}function m(e,t,n,i){try{e.call(t,n,i)}catch(o){return o}}function v(e,t,n){U(function(e){var i=!1,o=m(n,t,function(n){i||(i=!0,t!==n?w(e,n):E(e,n))},function(t){i||(i=!0,S(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&o&&(i=!0,S(e,o))},e)}function y(e,t){t._state===z?E(e,t._result):e._state===K?S(e,t._result):x(t,void 0,function(t){w(e,t)},function(t){S(e,t)})}function b(e,t){if(t.constructor===e.constructor)y(e,t);else{var n=g(t);n===V?S(e,V.error):void 0===n?E(e,t):o(n)?v(e,t,n):E(e,t)}}function w(e,t){e===t?S(e,p()):i(t)?b(e,t):E(e,t)}function C(e){e._onerror&&e._onerror(e._result),R(e)}function E(e,t){e._state===W&&(e._result=t,e._state=z,0===e._subscribers.length||U(R,e))}function S(e,t){e._state===W&&(e._state=K,e._result=t,U(C,e))}function x(e,t,n,i){var o=e._subscribers,r=o.length;e._onerror=null,o[r]=t,o[r+z]=n,o[r+K]=i,0===r&&e._state&&U(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i,o,r=e._result,s=0;s<t.length;s+=3)i=t[s],o=t[s+n],i?M(n,i,o,r):o(r);e._subscribers.length=0}}function I(){this.error=null}function D(e,t){try{return e(t)}catch(n){return G.error=n,G}}function M(e,t,n,i){var r,s,a,c,h=o(n);if(h){if(r=D(n,i),r===G?(c=!0,s=r.error,r=null):a=!0,t===r)return void S(t,f())}else r=i,a=!0;t._state!==W||(h&&a?w(t,r):c?S(t,s):e===z?E(t,r):e===K&&S(t,r))}function T(e,t){try{t(function(t){w(e,t)},function(t){S(e,t)})}catch(n){S(e,n)}}function N(e,t,n,i){this._instanceConstructor=e,this.promise=new e(u,i),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&E(this.promise,this._result))):S(this.promise,this._validationError())}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function _(e){this._id=$++,this._state=void 0,this._result=void 0,this._subscribers=[],u!==e&&(o(e)||O(),this instanceof _||P(),T(this,e))}var A;A=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var L,k=A,F=(Date.now||function(){return(new Date).getTime()},Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return s.prototype=e,new s},0),U=function(e,t){H[F]=e,H[F+1]=t,F+=2,2===F&&L()},j="undefined"!=typeof window?window:{},q=j.MutationObserver||j.WebKitMutationObserver,B="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,H=new Array(1e3);L="undefined"!=typeof e&&"[object process]"==={}.toString.call(e)?a():q?c():B?h():d();var W=void 0,z=1,K=2,V=new I,G=new I;N.prototype._validateInput=function(e){return k(e)},N.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},N.prototype._init=function(){this._result=new Array(this.length)};var J=N;N.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,i=0;t._state===W&&e>i;i++)this._eachEntry(n[i],i)},N.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;r(e)?e.constructor===n&&e._state!==W?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(z,t,e))},N.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===W&&(this._remaining--,this._abortOnReject&&e===K?S(i,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&E(i,this._result)},N.prototype._makeResult=function(e,t,n){return n},N.prototype._willSettleAt=function(e,t){var n=this;x(e,void 0,function(e){n._settledAt(z,t,e)},function(e){n._settledAt(K,t,e)})};var X=function(e,t){return new J(this,e,!0,t).promise},Y=function(e,t){function n(e){w(r,e)}function i(e){S(r,e)}var o=this,r=new o(u,t);if(!k(e))return S(r,new TypeError("You must pass an array to race.")),r;for(var s=e.length,a=0;r._state===W&&s>a;a++)x(o.resolve(e[a]),void 0,n,i);return r},Q=function(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var i=new n(u,t);return w(i,e),i},Z=function(e,t){var n=this,i=new n(u,t);return S(i,e),i},$=0,ee=_;_.all=X,_.race=Y,_.resolve=Q,_.reject=Z,_.prototype={constructor:_,then:function(e,t){var n=this,i=n._state;if(i===z&&!e||i===K&&!t)return this;var o=new this.constructor(u),r=n._result;if(i){var s=arguments[i-1];U(function(){M(i,o,s,r)})}else x(n,o,e,t);return o},"catch":function(e){return this.then(null,e)}};var te=function(){var e;e="undefined"!=typeof n?n:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),o(t)}();t||(e.Promise=ee)},ne={Promise:ee,polyfill:te};"function"==typeof define&&define.amd?define(function(){return ne}):"undefined"!=typeof t&&t.exports?t.exports=ne:"undefined"!=typeof this&&(this.ES6Promise=ne)}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],3:[function(e,t,n){function i(){if(!a){a=!0;for(var e,t=s.length;t;){e=s,s=[];for(var n=-1;++n<t;)e[n]();t=s.length}a=!1}}function o(){}var r=t.exports={},s=[],a=!1;r.nextTick=function(e){s.push(e),a||setTimeout(i,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=o,r.addListener=o,r.once=o,r.off=o,r.removeListener=o,r.removeAllListeners=o,r.emit=o,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],4:[function(e,t,n){"use strict";var i=null,o=null,r=null,s=function(e){return e?e.iceServers?(e.iceServers.forEach(function(e){e.url=e.urls,delete e.urls}),e):e:void 0},a=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},c=function(e){if(!e)return!1;var t=!1,n="m=application";return e.sdp.split("\n").forEach(function(e){e.slice(0,n.length)===n&&(t=!0)}),t};"undefined"!=typeof RTCPeerConnection?i=RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?i=function(e,t){var n=new mozRTCPeerConnection(s(e),t),i=!1,o=n.createDataChannel.bind(n);return n.createDataChannel=function(e,t){var r=o(e,t);if(!i&&(i=!0,n.onnegotiationneeded&&!c(n.localDescription)&&!c(n.remoteDescription))){var s=new Event("negotiationneeded");n.onnegotiationneeded(s)}return r},n}:"undefined"!=typeof webkitRTCPeerConnection&&(i=function(e,t){var n=new webkitRTCPeerConnection(e,t),i=n.getStats.bind(n);return n.getStats=function(e,t,n){var o=function(e){t(a(e))};i(o,n,e)},n}),"undefined"!=typeof RTCSessionDescription?o=RTCSessionDescription:"undefined"!=typeof mozRTCSessionDescription&&(o=mozRTCSessionDescription),"undefined"!=typeof RTCIceCandidate?r=RTCIceCandidate:"undefined"!=typeof mozRTCIceCandidate&&(r=mozRTCIceCandidate),n.RTCPeerConnection=i,n.RTCSessionDescription=o,n.RTCIceCandidate=r},{}],5:[function(e,t,n){(function(t){var i=e("../../src/util"),o=function(e){this.level=e.config&&e.config.debug||"log",this.console=e.config&&e.config.global.console,i.handleEvents(this)};o.level={debug:0,info:1,log:2,warn:3,error:4},o.prototype.print=function(e,n,i){var r=i;"undefined"!=typeof this.console&&this.console.freedom!==!0&&("string"==typeof r&&(r=[r]),void 0!==o.level[this.level]&&o.level[e]<o.level[this.level]||("undefined"!=typeof t&&"[object process]"==={}.toString.call(t)&&n?(r.unshift("[39m"),r.unshift("[31m"+n)):this.console.maxLogLevel&&n?(this.console.freedomDump||(this.console.freedomDump=this.console.dump,this.console.dump=function(){}),this.console.freedomDump("{"+n+"}."+e+": "+r.join(" ")+"\n"),r.unshift(n.toUpperCase())):this.console.__mozillaConsole__&&n?r.unshift(n.toUpperCase()):n&&(r.unshift("color: red"),r.unshift("%c "+n)),!this.console[e]&&this.console.log&&(e="log"),this.console[e].apply(this.console,r)))},o.prototype.log=function(e,t,n){this.print("log",e,t),n()},o.prototype.debug=function(e,t,n){this.print("debug",e,t),n()},o.prototype.info=function(e,t,n){this.print("info",e,t),n()},o.prototype.warn=function(e,t,n){this.print("warn",e,t),n()},o.prototype.error=function(e,t,n){this.print("error",e,t),n()},n.provider=o,n.name="core.console",n.flags={config:!0}}).call(this,e("_process"))},{"../../src/util":35,_process:3}],6:[function(e,t,n){var i=e("../../src/util"),o=function(e,t){this.mod=e.module,this.dispatchEvent=t,i.handleEvents(this),this.mod.once("core",function(e){this.core=new e}.bind(this)),this.mod.emit(this.mod.controlChannel,{type:"core request delegated to echo",request:"core"})};o.prototype.setup=function(e,t){return t(),this.core?void this.core.bindChannel(e,function(e){this.chan&&this.chan.close(),this.chan=e,this.chan.onClose(function(){delete this.chan}.bind(this)),this.dispatchEvent("message","channel bound to echo"),this.chan.on("message",function(e){this.dispatchEvent("message","from custom channel: "+e)}.bind(this))}.bind(this)):void this.dispatchEvent("message","no core available to setup proxy with at echo")},o.prototype.send=function(e,t){t(),this.chan?this.chan.emit("message",e):this.dispatchEvent("message","no channel available")},n.provider=o,n.name="core.echo",n.flags={module:!0}},{"../../src/util":35}],7:[function(e,t,n){var i=function(e,t,n){this.handlers=e,this.dispatchEvent=n,this.ongoing={}};i.register=function(e){var t,o=[];if(!e||!e.length)return i.reset();for(t=0;t<e.length;t+=1)o.push(new e[t]);n.provider=i.bind(this,o)},i.reset=function(){n.provider=i.bind(this,[])},i.prototype.initiateOAuth=function(e,t){var n,i;for(i=function(e){this.ongoing[e.state]=this.handlers[n],t(e)}.bind(this),n=0;n<this.handlers.length;n+=1)if(this.handlers[n].initiateOAuth(e,i))return;t(null,{errcode:"UNKNOWN",message:"No requested redirects can be handled."})},i.prototype.launchAuthFlow=function(e,t,n){return this.ongoing.hasOwnProperty(t.state)?(this.ongoing[t.state].launchAuthFlow(e,t,n),void delete this.ongoing[t.state]):void n(void 0,{errcode:"UNKNOWN",message:"You must begin the oAuth flow with initiateOAuth first"})},n.register=i.register,n.reset=i.reset,n.provider=i.bind(this,[]),n.name="core.oauth"},{}],8:[function(e,t,n){function i(e,t,n,i){var o,s,a;if(this.peerName=e,this.channels={},this.dataChannelCallbacks=n,this.onConnectedQueue=[],"undefined"!=typeof i.RTCPeerConnection)this.RTCPeerConnection=i.RTCPeerConnection;else if("undefined"!=typeof webkitRTCPeerConnection)this.RTCPeerConnection=webkitRTCPeerConnection;else{if("undefined"==typeof mozRTCPeerConnection)throw new Error("This environment does not appear to support RTCPeerConnection");this.RTCPeerConnection=mozRTCPeerConnection}if("undefined"!=typeof i.RTCSessionDescription)this.RTCSessionDescription=i.RTCSessionDescription;else if("undefined"!=typeof RTCSessionDescription)this.RTCSessionDescription=RTCSessionDescription;else{if("undefined"==typeof mozRTCSessionDescription)throw new Error("This environment does not appear to support RTCSessionDescription");this.RTCSessionDescription=mozRTCSessionDescription}if("undefined"!=typeof i.RTCIceCandidate)this.RTCIceCandidate=i.RTCIceCandidate;else if("undefined"!=typeof RTCIceCandidate)this.RTCIceCandidate=RTCIceCandidate;else{if("undefined"==typeof mozRTCIceCandidate)throw new Error("This environment does not appear to support RTCIceCandidate");this.RTCIceCandidate=mozRTCIceCandidate}for(o={optional:[{DtlsSrtpKeyAgreement:!0}]},this.sendSignalMessage=null,this.pc=null,s={iceServers:[]},a=0;a<t.length;a+=1)s.iceServers.push({url:t[a]});this.pc=new this.RTCPeerConnection(s,o),this.pc.addEventListener("icecandidate",this.onIceCallback.bind(this)),this.pc.addEventListener("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.pc.addEventListener("datachannel",this.onDataChannel.bind(this)),this.pc.addEventListener("signalingstatechange",function(){"stable"===this.pc.signalingState&&(this.pcState=r.CONNECTED,this.onConnectedQueue.map(function(e){e()}))}.bind(this)),this.pcState=r.DISCONNECTED}function o(e,t,n,i,o){this.dispatchEvent=t,this.peerName="p"+Math.random(),this.freedomModule=e.module,this.RTCPeerConnection=n,this.RTCSessionDescription=i,this.RTCIceCandidate=o,this.signallingChannel=null,this.peer=null,this.freedomModule.once("core",function(e){this.core=new e}.bind(this)),this.freedomModule.emit(this.freedomModule.controlChannel,{type:"core request delegated to peerconnection",request:"core"})}var r={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED"};i.prototype.createOffer=function(e,t){this.pc.createOffer(t,function(){console.error("core.peerconnection createOffer failed.")},e)},i.prototype.runWhenConnected=function(e){this.pcState===r.CONNECTED?e():this.onConnectedQueue.push(e)},i.prototype.send=function(e,t,n){this.channels[e].send(t),n()},i.prototype.openDataChannel=function(e,t){var n=this.pc.createDataChannel(e,{});n.onopen=function(){this.addDataChannel(e,n),t()}.bind(this),n.onerror=function(e){console.error(e),t(void 0,e)},"undefined"!=typeof mozRTCPeerConnection&&this.pcState===r.DISCONNECTED&&this.negotiateConnection()},i.prototype.closeChannel=function(e){void 0!==this.channels[e]&&(this.channels[e].close(),delete this.channels[e])},i.prototype.getBufferedAmount=function(e,t){if(void 0!==this.channels[e]){var n=this.channels[e];return n.bufferedAmount}throw new Error("No channel with id: "+e)},i.prototype.setSendSignalMessage=function(e){this.sendSignalMessage=e},i.prototype.handleSignalMessage=function(e){var t,n=JSON.parse(e);n.sdp?this.pc.setRemoteDescription(new this.RTCSessionDescription(n.sdp),function(){"offer"===this.pc.remoteDescription.type&&this.pc.createAnswer(this.onDescription.bind(this),console.error)}.bind(this),function(e){console.error(this.peerName+": setRemoteDescription failed:",e)}.bind(this)):n.candidate?(t=new this.RTCIceCandidate(n.candidate),this.pc.addIceCandidate(t)):console.warn(this.peerName+": handleSignalMessage got unexpected message: ",e)},i.prototype.negotiateConnection=function(){this.pcState=r.CONNECTING,this.pc.createOffer(this.onDescription.bind(this),function(e){console.error(this.peerName+": createOffer failed: ",e.toString()),this.pcState=r.DISCONNECTED}.bind(this))},i.prototype.isClosed=function(){return!this.pc||"closed"===this.pc.signalingState},i.prototype.close=function(){this.isClosed()||this.pc.close()},i.prototype.addDataChannel=function(e,t){var n=this.dataChannelCallbacks;this.channels[e]=t,"connecting"===t.readyState&&(t.onopen=n.onOpenFn.bind(this,t,{label:e})),t.onclose=n.onCloseFn.bind(this,t,{label:e}),t.onmessage=n.onMessageFn.bind(this,t,{label:e}),t.onerror=n.onErrorFn.bind(this,t,{label:t})},i.prototype.onDescription=function(e){this.sendSignalMessage?this.pc.setLocalDescription(e,function(){this.sendSignalMessage(JSON.stringify({sdp:e}))}.bind(this),function(e){console.error(this.peerName+": setLocalDescription failed:",e)}.bind(this)):console.error(this.peerName+": _onDescription: _sendSignalMessage is not set, so we did not set the local description. ")},i.prototype.onNegotiationNeeded=function(e){if(this.pcState!==r.DISCONNECTED){var t=function(e){return function(){}.bind(this)}.bind(this),n=function(e){
return function(e){}.bind(this)}.bind(this);return void(this.pc.localDescription&&this.pc.remoteDescription&&"offer"===this.pc.localDescription.type?(this.pc.setLocalDescription(this.pc.localDescription,t("setLocalDescription"),n("setLocalDescription")),this.pc.setRemoteDescription(this.pc.remoteDescription,t("setRemoteDescription"),n("setRemoteDescription"))):this.pc.localDescription&&this.pc.remoteDescription&&"answer"===this.pc.localDescription.type?(this.pc.setRemoteDescription(this.pc.remoteDescription,t("setRemoteDescription"),n("setRemoteDescription")),this.pc.setLocalDescription(this.pc.localDescription,t("setLocalDescription"),n("setLocalDescription"))):console.error(this.peerName+", onNegotiationNeeded failed"))}this.negotiateConnection()},i.prototype.onIceCallback=function(e){e.candidate&&(this.sendSignalMessage?this.sendSignalMessage(JSON.stringify({candidate:e.candidate})):console.warn(this.peerName+": _onDescription: _sendSignalMessage is not set."))},i.prototype.onSignalingStateChange=function(){"stable"===this.pc.signalingState&&(this.pcState=r.CONNECTED,this.onConnectedQueue.map(function(e){e()}))},i.prototype.onDataChannel=function(e){this.addDataChannel(e.channel.label,e.channel),"open"===e.channel.readyState&&this.dataChannelCallbacks.onOpenFn(e.channel,{label:e.channel.label})},o.prototype.setup=function(e,t,n,o,r){this.peerName=t;var s,a,c={RTCPeerConnection:this.RTCPeerConnection,RTCSessionDescription:this.RTCSessionDescription,RTCIceCandidate:this.RTCIceCandidate},h=this,d={onOpenFn:function(e,t){h.dispatchEvent("onOpenDataChannel",{channelId:t.label})},onCloseFn:function(e,t){h.dispatchEvent("onCloseDataChannel",{channelId:t.label})},onMessageFn:function(e,t,n){n.data instanceof ArrayBuffer?h.dispatchEvent("onReceived",{channelLabel:t.label,buffer:n.data}):n.data instanceof Blob?h.dispatchEvent("onReceived",{channelLabel:t.label,binary:n.data}):"string"==typeof n.data&&h.dispatchEvent("onReceived",{channelLabel:t.label,text:n.data})},onErrorFn:function(e,t,n){console.error(e.peerName+": dataChannel("+e.dataChannel.label+"): error: ",n)}};this.peer=new i(this.peerName,n,d,c),this.core.bindChannel(e,function(e){this.signallingChannel=e,this.peer.setSendSignalMessage(function(e){this.signallingChannel.emit("message",e)}.bind(this)),this.signallingChannel.on("message",this.peer.handleSignalMessage.bind(this.peer)),this.signallingChannel.emit("ready"),o||this.peer.runWhenConnected(r)}.bind(this)),o&&(console.log(this.peerName+" initiating connection"),s="hello"+Math.random().toString(),a=function(e,t){t?r(void 0,t):this.closeDataChannel(s,r)}.bind(this),this.openDataChannel(s,a))},o.prototype.createOffer=function(e,t){this.peer.createOffer(e,t)},o.prototype.openDataChannel=function(e,t){this.peer.openDataChannel(e,t)},o.prototype.closeDataChannel=function(e,t){this.peer.closeChannel(e),t()},o.prototype.send=function(e,t){var n=e.text||e.buffer||e.binary;return"undefined"==typeof n?void console.error("No valid data to send has been provided.",e):void this.peer.send(e.channelLabel,n,t)},o.prototype.getBufferedAmount=function(e,t){t(this.peer.getBufferedAmount(e))},o.prototype.close=function(e){return this.peer.isClosed()?void e():(this.peer.close(),this.dispatchEvent("onClose"),void e())},n.provider=o,n.name="core.peerconnection",n.flags={module:!0}},{}],9:[function(e,t,n){var i=e("../../src/util"),o=["onopen","onerror","onclose","onmessage"],r={},s={},a=function(e){var t=i.getId();return r[t]=e,s[t]=[],o.forEach(function(n){var i=function(o){var r=e[n];if(r===i)s[t].push(o);else{if("function"!=typeof r)throw new Error("No handler for "+o.type+" event");r(o)}};e[n]=i}),t},c=function(t,n,i){if(this.dispatchEvent=n,!r[i]){console.warn("Invalid ID, creating acting on unattached DataChannel");var o=e("./core.rtcpeerconnection").provider,s=new o;i=s.createDataChannel(),s.close()}this.channel=r[i],delete r[i],setTimeout(function(){this.drainPendingEvents(i),this.manageEvents(!0)}.bind(this),0)};c.prototype.drainPendingEvents=function(e){s[e].forEach(function(e){this["on"+e.type](e)}.bind(this)),delete s[e]},c.prototype.manageEvents=function(e){o.forEach(function(t){e?(this[t]=this[t].bind(this),this.channel[t]=this[t]):delete this.channel[t]}.bind(this))},c.prototype.getLabel=function(e){e(this.channel.label)},c.prototype.getOrdered=function(e){e(this.channel.ordered)},c.prototype.getMaxPacketLifeTime=function(e){e(this.channel.maxPacketLifeTime)},c.prototype.getMaxRetransmits=function(e){e(this.channel.maxRetransmits)},c.prototype.getProtocol=function(e){e(this.channel.protocol)},c.prototype.getNegotiated=function(e){e(this.channel.negotiated)},c.prototype.getId=function(e){e(this.channel.id)},c.prototype.getReadyState=function(e){e(this.channel.readyState)},c.prototype.getBufferedAmount=function(e){e(this.channel.bufferedAmount)},c.prototype.getBinaryType=function(e){e(this.channel.binaryType)},c.prototype.setBinaryType=function(e,t){this.channel.binaryType=e,t()},c.prototype.send=function(e,t){this.channel.send(e),t()},c.prototype.sendBuffer=function(e,t){this.channel.send(e),t()},c.prototype.close=function(e){return this.channel?(this.manageEvents(!1),this.channel.close(),void e()):e()},c.prototype.onopen=function(e){this.dispatchEvent("onopen",e.message)},c.prototype.onerror=function(e){this.dispatchEvent("onerror",{errcode:e.type,message:e.message})},c.prototype.onclose=function(e){this.dispatchEvent("onclose",e.message)},c.prototype.onmessage=function(e){if("string"==typeof e.data)this.dispatchEvent("onmessage",{text:e.data});else if("arraybuffer"!==this.channel.binaryType||"undefined"==typeof Components||e.data instanceof ArrayBuffer)this.dispatchEvent("onmessage",{buffer:e.data});else{var t=Components.utils.cloneInto(e.data,{});this.dispatchEvent("onmessage",{buffer:t})}},n.name="core.rtcdatachannel",n.provider=c,n.allocate=a},{"../../src/util":35,"./core.rtcpeerconnection":10}],10:[function(e,t,n){var i=e("webrtc-adapter"),o=e("es6-promise").Promise,r=i.RTCPeerConnection,s=i.RTCSessionDescription,a=i.RTCIceCandidate,c=e("./core.rtcdatachannel"),h=function(e,t,n){this.dispatchEvent=t;try{this.connection=new r(n)}catch(i){return void setTimeout(e.provider.close.bind(e.provider,this),0)}this.events=["ondatachannel","onnegotiationneeded","onicecandidate","onsignalingstatechange","onaddstream","onremovestream","oniceconnectionstatechange"],this.manageEvents(!0)};h.prototype.manageEvents=function(e){this.events.forEach(function(t){e?(this[t]=this[t].bind(this),this.connection[t]=this[t]):this.connection&&delete this.connection[t]}.bind(this))},h.prototype.createOffer=function(e){return new o(function(t,n){this.connection.createOffer(t,n,e)}.bind(this))},h.prototype.createAnswer=function(){return new o(function(e,t){this.connection.createAnswer(e,t)}.bind(this))},h.prototype.setLocalDescription=function(e){return new o(function(t,n){this.connection.setLocalDescription(new s(e),t,n)}.bind(this))},h.prototype.getLocalDescription=function(){return o.resolve(this.connection.localDescription)},h.prototype.setRemoteDescription=function(e){return new o(function(t,n){this.connection.setRemoteDescription(new s(e),t,n)}.bind(this))},h.prototype.getRemoteDescription=function(){return o.resolve(this.connection.remoteDescription)},h.prototype.getSignalingState=function(){return o.resolve(this.connection.signalingState)},h.prototype.updateIce=function(e){return this.connection.updateIce(e),o.resolve()},h.prototype.addIceCandidate=function(e){return new o(function(t,n){this.connection.addIceCandidate(new a(e),t,n)}.bind(this))},h.prototype.getIceGatheringState=function(){return o.resolve(this.connection.iceGatheringState)},h.prototype.getIceConnectionState=function(){return o.resolve(this.connection.iceConnectionState)},h.prototype.getConfiguration=function(){var e=this.connection.getConfiguration();return o.resolve(e)},h.prototype.getLocalStreams=function(){return o.reject({errcode:-1,message:"Not Implemented"})},h.prototype.getRemoteStreams=function(){return o.reject({errcode:-1,message:"Not Implemented"})},h.prototype.getStreamById=function(e){return o.reject({errcode:-1,message:"Not Implemented"})},h.prototype.addStream=function(e){return o.reject({errcode:-1,message:"Not Implemented"})},h.prototype.removeStream=function(e){return o.reject({errcode:-1,message:"Not Implemented"})},h.prototype.close=function(){if(!this.connection)return o.resolve();this.manageEvents(!1);try{return this.connection.close(),o.resolve()}catch(e){return o.reject({errcode:e.name,message:e.message})}},h.prototype.createDataChannel=function(e,t){var n=c.allocate(this.connection.createDataChannel(e,t));return o.resolve(n)},h.prototype.getStats=function(e){return new o(function(t,n){this.connection.getStats(e,t,n)}.bind(this))},h.prototype.ondatachannel=function(e){var t=c.allocate(e.channel);this.dispatchEvent("ondatachannel",{channel:t})},h.prototype.onnegotiationneeded=function(e){this.dispatchEvent("onnegotiationneeded",e.message)},h.prototype.onicecandidate=function(e){var t;t=e.candidate&&e.candidate.candidate?{candidate:{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}}:{candidate:null},this.dispatchEvent("onicecandidate",t)},h.prototype.onsignalingstatechange=function(e){this.dispatchEvent("onsignalingstatechange",e.message)},h.prototype.onaddstream=function(e){this.dispatchEvent("onaddstream",e.stream)},h.prototype.onremovestream=function(e){this.dispatchEvent("onremovestream",e.stream)},h.prototype.oniceconnectionstatechange=function(e){this.dispatchEvent("oniceconnectionstatechange",e.message)},n.name="core.rtcpeerconnection",n.provider=h,n.style="providePromises",n.flags={provider:!0}},{"./core.rtcdatachannel":9,"es6-promise":2,"webrtc-adapter":4}],11:[function(e,t,n){var i=e("../../src/util"),o=function(e,t){i.handleEvents(this)};o.prototype.keys=function(e){var t,n=[];for(t=0;t<localStorage.length;t+=1)n.push(localStorage.key(t));e(n)},o.prototype.get=function(e,t){try{var n=localStorage.getItem(e);t(n)}catch(i){t(null)}},o.prototype.set=function(e,t,n){var i=localStorage.getItem(e);localStorage.setItem(e,t),n(i)},o.prototype.remove=function(e,t){var n=localStorage.getItem(e);localStorage.removeItem(e),t(n)},o.prototype.clear=function(e){localStorage.clear(),e()},n.provider=o,n.name="core.storage"},{"../../src/util":35}],12:[function(e,t,n){var i=e("../../src/proxy/eventInterface"),o=e("../../src/consumer"),r=e("../../src/util"),s=function(e,t){this.manager=e.module,this.debug=this.manager.debug};s.unboundChannels={},s.contextId=void 0,s.prototype.createChannel=function(e){var t=new o(i,this.manager.debug),n=r.getId(),a=this.getChannel(t);this.manager.setup(t),this.manager.delegate&&this.manager.toDelegate.core&&this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"register",id:n}}),s.unboundChannels[n]={local:!0,proxy:t},t.once("start",this.getChannel.bind(this,t)),e({channel:a,identifier:n})},s.prototype.getChannel=function(e){var t=e.getProxyInterface(),n=t();return n.close=t.close,n.onClose=t.onClose,t.onClose(n,function(){e.doClose()}),n},s.prototype.onMessage=function(e,t){"register"===t.type?s.unboundChannels[t.id]={remote:!0,resolve:t.reply,source:e}:"clear"===t.type?delete s.unboundChannels[t.id]:"bind"===t.type&&s.unboundChannels[t.id]&&this.bindChannel(t.id,function(){},e)},s.prototype.bindChannel=function(e,t,n){var r=s.unboundChannels[e],a=!n;if(a&&(this.debug.debug("making local proxy for core binding"),n=new o(i,this.debug),this.manager.setup(n)),r&&r.local)this.debug.debug("Binding a channel to port on this hub:"+n),this.manager.createLink(n,e,r.proxy,"default"),delete s.unboundChannels[e],this.manager.delegate&&this.manager.toDelegate.core&&this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"clear",id:e}});else{if(!r||!r.remote)return this.manager.delegate&&this.manager.toDelegate.core?(this.debug.info("delegating channel bind for an unknown ID:"+e),this.manager.emit(this.manager.delegate,{type:"Delegation",request:"handle",flow:"core",message:{type:"bind",id:e}}),n.once("start",function(e,t){t(this.getChannel(e))}.bind(this,n,t)),this.manager.createLink(n,"default",this.manager.hub.getDestination(this.manager.delegate),e),void delete s.unboundChannels[e]):(this.debug.warn("Asked to bind unknown channel: "+e),this.debug.log(s.unboundChannels),void t());this.debug.debug("Binding a channel into a module."),this.manager.createLink(n,a?"default":e,r.source,e),r.resolve({type:"Bind Channel",request:"core",flow:"core",message:{type:"bind",id:e}}),delete s.unboundChannels[e]}n.getInterface?t(this.getChannel(n)):t()},s.prototype.getId=function(e){e(s.contextId)},s.prototype.getLogger=function(e,t){t(this.manager.debug.getLogger(e))},s.prototype.setId=function(e){s.contextId=e},n.provider=s,n.name="core",n.flags={module:!0}},{"../../src/consumer":20,"../../src/proxy/eventInterface":32,"../../src/util":35}],13:[function(e,t,n){var i=e("../../src/util"),o=e("es6-promise").Promise,r=function(e,t,n){this.provider=e,this.dispatchEvent=n,setTimeout(t.provider.onClose.bind(t.provider,this,this.close.bind(this,function(){})),0),this.module=t.module,i.handleEvents(this)};r.provider={listener:void 0,active:{},onOpen:function(e,t,n,i,r){var s,a,c=document.body;return this.listener||(this.listener=function(e){var t;for(t in this.active)this.active.hasOwnProperty(t)&&this.active[t].source===e.source&&this.active[t].postMessage(e.data)}.bind(this),window.addEventListener("message",this.listener,!0)),document.getElementById(t)&&(c=document.getElementById(t)),s=document.createElement("div"),s.style.width="100%",s.style.height="100%",s.style.display="relative",c.appendChild(s),new o(function(t,i){a=document.createElement("iframe"),a.setAttribute("sandbox","allow-scripts allow-forms"),a.style.width="100%",a.style.height="100%",a.style.border="0",a.style.background="transparent",a.src=n,a.addEventListener("load",t,!0),a.addEventListener("error",i,!0),s.appendChild(a),this.active[e]={postMessage:r,container:c,root:s,source:a.contentWindow}}.bind(this))},onMessage:function(e,t){this.active[e].source.postMessage(t,"*")},onClose:function(e){this.active[e].container.removeChild(this.active[e].root),delete this.active[e],0===Object.keys(this.active).length&&(window.removeEventListener("message",this.listener,!0),this.listener=void 0)}},r.prototype.show=function(e,t){if(this.id)return t(void 0,{errcode:"ALREADY_OPEN",message:"Cannot show multiple views through one instance."});this.id=i.getId();var n=this.module.manifest.views,r=[];return n&&n[e]?void(n[e].main&&n[e].files?(r=n[e].files.concat(n[e].main),o.all(r.map(function(e){return this.module.resource.get(this.module.manifestId,e)}.bind(this))).then(function(n){this.provider.onOpen(this.id,e,n[n.length-1],n,this.dispatchEvent.bind(this,"message")).then(function(e){e()}.bind({},t),t.bind({},void 0))}.bind(this),function(n){this.module.debug.error("Unable to open view "+e+": ",n),t(void 0,{errcode:"VIEW_MALFORMED",message:"Malformed View Declaration: "+n})})):t(void 0,{errcode:"NON_EXISTANT",message:"View not found: "+e})):t(void 0,{errcode:"NON_EXISTANT",message:"View not found: "+e})},r.prototype.isSecure=function(e){e(!1)},r.prototype.postMessage=function(e,t){return this.id?(this.provider.onMessage(this.id,e),void t()):t(void 0,{errcode:"NOT_OPEN",message:"Cannot post message to uninitialized view."})},r.prototype.close=function(e){return this.id?(this.provider.onClose(this.id),delete this.id,void e()):e(void 0,{errcode:"NOT_OPEN",message:"Cannot close uninitialized view."})},r.register=function(e){var t=e?new e:r.provider;n.provider=r.bind(this,t)},n.provider=r.bind(this,r.provider),n.name="core.view",n.register=r.register,n.flags={provider:!0,module:!0}},{"../../src/util":35,"es6-promise":2}],14:[function(e,t,n){var i=null,o=!1,r=function(e,t,n,r,s){var a,c=null;this.isNode=o,"undefined"!=typeof s?c=s:null!==i?c=i:"undefined"!=typeof WebSocket?c=WebSocket:console.error("Platform does not support WebSocket"),this.dispatchEvent=t;try{r?this.websocket=new c(n,r):this.websocket=new c(n),this.websocket.binaryType="arraybuffer"}catch(h){return a={},h instanceof SyntaxError?a.errcode="SYNTAX":a.errcode=h.name,a.message=h.message,void t("onError",a)}this.isNode?(this.websocket.on("message",this.onMessage.bind(this)),this.websocket.on("open",this.onOpen.bind(this)),this.websocket.on("close",this.onClose.bind(this,{code:0,reason:"UNKNOWN",wasClean:!0})),this.websocket.on("error",this.onError.bind(this))):(this.websocket.onopen=this.onOpen.bind(this),this.websocket.onclose=this.onClose.bind(this),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onerror=this.onError.bind(this))};r.prototype.send=function(e,t){var n,i,o=e.text||e.binary||e.buffer;if(o)try{this.isNode&&o instanceof ArrayBuffer?this.websocket.send(new Uint8Array(o),{binary:!0},this.onError.bind(this)):this.websocket.send(o)}catch(r){n=r instanceof SyntaxError?"SYNTAX":"INVALID_STATE",i=r.message}else n="BAD_SEND",i="No text, binary, or buffer data found.";n?t(void 0,{errcode:n,message:i}):t()},r.prototype.getReadyState=function(e){e(this.websocket.readyState)},r.prototype.getBufferedAmount=function(e){e(this.websocket.bufferedAmount)},r.prototype.close=function(e,t,n){try{e&&t?this.websocket.close(e,t):this.websocket.close(),n()}catch(i){var o;o=i instanceof SyntaxError?"SYNTAX":"INVALID_ACCESS",n(void 0,{errcode:o,message:i.message})}},r.prototype.onOpen=function(e){this.dispatchEvent("onOpen")},r.prototype.onMessage=function(e,t){var n={};this.isNode&&t&&t.binary?n.buffer=new Uint8Array(e).buffer:this.isNode?n.text=e:"undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?n.buffer=e.data:"undefined"!=typeof Blob&&e.data instanceof Blob?n.binary=e.data:"string"==typeof e.data&&(n.text=e.data),this.dispatchEvent("onMessage",n)},r.prototype.onError=function(e){this.dispatchEvent("onError")},r.prototype.onClose=function(e){this.dispatchEvent("onClose",{code:e.code,reason:e.reason,wasClean:e.wasClean})},n.provider=r,n.name="core.websocket",n.setSocket=function(e,t){i=e,o=t}},{}],15:[function(e,t,n){var i=e("es6-promise").Promise,o=null,r=function(e,t){"use strict";"undefined"!=typeof window&&"undefined"!=typeof window.XMLHttpRequest&&null===o?o=window.XMLHttpRequest:"undefined"!=typeof XMLHttpRequest&&null===o?o=XMLHttpRequest:null===o&&console.error("Platform does not support XMLHttpRequest"),this._dispatchEvent=t,this._xhr=new o,setTimeout(e.provider.onClose.bind(e.provider,this,this.abort.bind(this)),0),this._events=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"],this._setupListeners()};r.prototype.open=function(e,t,n,o,r){"use strict";return"undefined"!=typeof n&&n!==!0?i.reject({errcode:"InvalidAccessError",message:"async should always be set to true"}):(this._xhr.open(e,t,!0,o,r),i.resolve())},r.prototype.send=function(e){"use strict";return e instanceof Object?e.hasOwnProperty("string")?this._xhr.send(e.string):e.hasOwnProperty("buffer")?this._xhr.send(e.buffer):this._xhr.send():this._xhr.send(),i.resolve()},r.prototype.abort=function(){"use strict";return this._xhr.abort(),i.resolve()},r.prototype.getResponseHeader=function(e){"use strict";return i.resolve(this._xhr.getResponseHeader(e))},r.prototype.getAllResponseHeaders=function(){"use strict";return i.resolve(this._xhr.getAllResponseHeaders())},r.prototype.setRequestHeader=function(e,t){"use strict";return this._xhr.setRequestHeader(e,t),i.resolve()},r.prototype.overrideMimeType=function(e){"use strict";return this._xhr.overrideMimeType(e),i.resolve()},r.prototype.getReadyState=function(){"use strict";return i.resolve(this._xhr.readyState)},r.prototype.getResponse=function(){"use strict";return null===this._xhr.response?i.resolve(null):"text"===this._xhr.responseType||""===this._xhr.responseType?i.resolve({string:this._xhr.response}):"arraybuffer"===this._xhr.responseType?i.resolve({buffer:this._xhr.response}):"json"===this._xhr.responseType?i.resolve({object:this._xhr.response}):i.reject("core.xhr cannot determine type of response")},r.prototype.getResponseText=function(){"use strict";return i.resolve(this._xhr.responseText)},r.prototype.getResponseURL=function(){"use strict";return i.resolve(this._xhr.responseURL)},r.prototype.getResponseType=function(){"use strict";return i.resolve(this._xhr.responseType)},r.prototype.setResponseType=function(e){"use strict";return this._xhr.responseType=e,i.resolve()},r.prototype.getStatus=function(){"use strict";return i.resolve(this._xhr.status)},r.prototype.getStatusText=function(){"use strict";return i.resolve(this._xhr.statusText)},r.prototype.getTimeout=function(){"use strict";return i.resolve(this._xhr.timeout)},r.prototype.setTimeout=function(e){"use strict";return this._xhr.timeout=e,i.resolve()},r.prototype.getWithCredentials=function(){"use strict";return i.resolve(this._xhr.withCredentials)},r.prototype.setWithCredentials=function(e){"use strict";return this._xhr.withCredentials=e,i.resolve()},r.prototype._setupListeners=function(){"use strict";this._events.forEach(function(e){this._xhr.addEventListener(e,function(e,t){this._dispatchEvent("on"+e,t)}.bind(this,e),!1)}.bind(this)),this._events.forEach(function(e){this._xhr.upload.addEventListener(e,function(e,t){this._dispatchEvent("onupload"+e,t)}.bind(this,e),!1)}.bind(this))},n.name="core.xhr",n.provider=r,n.style="providePromises",n.flags={provider:!0},n.setImpl=function(e){"use strict";o=e}},{"es6-promise":2}],16:[function(e,t,n){var i=(e("es6-promise").Promise,"freedom.oauth.redirect.handler"),o=!1;"undefined"!=typeof window&&window&&window.location&&window.addEventListener&&(window.addEventListener("load",function(){"use strict";o=!0},!0),window.localStorage&&window.location.href.indexOf(i)>0&&(window.localStorage.setItem(i,new Date),window.close()));var r=function(){"use strict";this.listeners={}};r.prototype.initiateOAuth=function(e,t){"use strict";if("undefined"!=typeof window&&window&&o){var n=window.location.protocol+"//"+window.location.host+window.location.pathname;if(e.indexOf(n)>-1)return t({redirect:n,state:i+Math.random()}),!0}return!1},r.prototype.launchAuthFlow=function(e,t,n){"use strict";var i=this.storageListener.bind(this,n,t);this.listeners[t.state]=i,window.addEventListener("storage",i,!1),window.open(e)},r.prototype.storageListener=function(e,t,n){"use strict";n.url.indexOf(t.state)>-1&&(window.removeEventListener("storage",this.listeners[t.state],!1),delete this.listeners[t.state],e(n.url))},t.exports=r},{"es6-promise":2}],17:[function(e,t,n){(function(n){function i(){"use strict";this.listeners={}}var o=(e("es6-promise").Promise,"freedom.oauth.redirect.handler");i.prototype.initiateOAuth=function(e,t){"use strict";if("undefined"!=typeof n&&n&&n.document)for(var i=0;i<e.length;i++)if((0===e[i].indexOf("http://")||0===e[i].indexOf("https://"))&&e[i].indexOf("oauth-relay.html")>0)return t({redirect:e[i],state:o+Math.random()}),!0;return!1},i.prototype.launchAuthFlow=function(e,t,i){"use strict";var o=n.document.createElement("iframe");o.src=t.redirect,o.style.display="none",n.document.body.appendChild(o),o.addEventListener("load",function(){this.listeners[t.state]=i,window.open(e),o.contentWindow.postMessage(t.state,"*")}.bind(this)),window.addEventListener("message",function(e,t){if(t.data&&t.data.key&&t.data.url&&this.listeners[t.data.key]){this.listeners[t.data.key](t.data.url),delete this.listeners[t.data.key];try{document.body.removeChild(e)}catch(n){console.warn(n)}}}.bind(this,o),!1)},t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":2}],18:[function(e,t,n){var i=e("es6-promise").Promise,o=function(e){this.debug=e,this.apis={},this.providers={},this.waiters={}};o.prototype.get=function(e){return this.apis[e]?{name:e,definition:this.apis[e]}:!1},o.prototype.set=function(e,t){this.apis[e]=t},o.prototype.register=function(e,t,n,i){var o,r;if(this.providers[e]={constructor:t,style:n||"provideAsynchronous",flags:i||{}},this.waiters[e]){for(o=0;o<this.waiters[e].length;o+=1)r={},i.module&&(r.module=this.waiters[e][o].from),i.config&&(r.config=this.waiters[e][o].from.config),this.waiters[e][o].resolve({args:r,inst:t.bind({},r)});delete this.waiters[e]}},o.prototype.getCore=function(e,t){return new i(function(n,i){if(this.apis[e])if(this.providers[e]){var o={};this.providers[e].flags.module&&(o.module=t),this.providers[e].flags.config&&(o.config=t.config),n({args:o,inst:this.providers[e].constructor.bind({},o)})}else this.waiters[e]||(this.waiters[e]=[]),this.waiters[e].push({resolve:n,reject:i,from:t});else this.debug.warn("Api.getCore asked for unknown core: "+e),i(null)}.bind(this))},o.prototype.provideCore=function(e,t,n){return this.getCore(e,n).then(function(n){var i=this.providers[e].flags,o=t.getProxyInterface();i.provider&&(n.args.provider=o),o()[this.providers[e].style](n.inst)}.bind(this),function(e){this.debug.error("Could not provide core: ",e)}.bind(this))},o.prototype.cleanup=function(){var e,t=function(e){e.reject()};for(e in this.waiters)this.waiters.hasOwnProperty(e)&&this.waiters[e].forEach(t);delete this.waiters},t.exports=o},{"es6-promise":2}],19:[function(e,t,n){var i=function(){"use strict";this.interfaces=e("../dist/bundle.compiled")};n.register=function(e,t){"use strict";var n=new i;n.interfaces.forEach(function(e){e&&e.name&&e.api&&t.set(e.name,e.api)}),e.forEach(function(e){e.name&&t.register(e.name,e.provider,e.style,e.flags)})}},{"../dist/bundle.compiled":1}],20:[function(e,t,n){var i=e("./util"),o=function(e,t){this.id=o.nextId(),this.interfaceCls=e,this.debug=t,i.handleEvents(this),this.ifaces={},this.closeHandlers={},this.errorHandlers={},this.emits={}};o.prototype.onMessage=function(e,t){if("control"===e&&t.reverse)this.emitChannel=t.channel,this.emit(this.emitChannel,{type:"channel announcement",channel:t.reverse}),this.emit("start");else if("control"===e&&"setup"===t.type)this.controlChannel=t.channel;else if("control"===e&&"close"===t.type)delete this.controlChannel,this.doClose();else{if(!this.emitChannel&&t.channel)return this.emitChannel=t.channel,void this.emit("start");if("close"===t.type&&t.to)return void this.teardown(t.to);if("error"===t.type)return void this.error(t.to,t.message);if(t.to)this.emits[t.to]?this.emits[t.to]("message",t.message):this.debug.warn("Could not deliver message, no such interface: "+t.to);else{t.message;i.eachProp(this.emits,function(e){e("message",t.message)})}}},o.prototype.getInterface=function(){var e=this.getInterfaceConstructor(),t=Array.prototype.slice.call(arguments,0);return t.length&&(e=e.bind.apply(e,[e].concat(t))),new e},o.prototype.getListener=function(e){return function(t,n){if("function"==typeof t&&void 0===n)return void this.once(e,t);var o=e+"Handlers";i.eachProp(this.ifaces,function(e,i){return e===t?(this[o][i]?this[o][i].push(n):this[o][i]=[n],!0):void 0}.bind(this))}.bind(this)},o.prototype.getProxyInterface=function(){var e=function(e){var t=Array.prototype.slice.call(arguments,1);return t.length>0?e.getInterface.apply(e,t):e.getInterface()}.bind({},this);return e.close=function(e){e?i.eachProp(this.ifaces,function(t,n){return t===e?(this.teardown(n),this.emit(this.emitChannel,{type:"close",to:n}),!0):void 0}.bind(this)):this.doClose()}.bind(this),e.onClose=this.getListener("close"),e.onError=this.getListener("error"),e},o.prototype.getInterfaceConstructor=function(){var e=o.nextId();return this.interfaceCls.bind({},function(e,t,n){this.ifaces[e]=t,this.emits[e]=n}.bind(this,e),this.doEmit.bind(this,e),this.debug)},o.prototype.doEmit=function(e,t,n){n&&(e=!1),this.emitChannel?this.emit(this.emitChannel,{to:e,type:"message",message:t}):this.once("start",this.doEmit.bind(this,e,t))},o.prototype.teardown=function(e){this.emits[e]&&this.emits[e]("close"),delete this.emits[e],this.closeHandlers[e]&&i.eachProp(this.closeHandlers[e],function(e){e()}),delete this.ifaces[e],delete this.closeHandlers[e],delete this.errorHandlers[e]},o.prototype.error=function(e,t){e&&this.errorHandlers[e]?i.eachProp(this.errorHandlers[e],function(e){e(t)}):e||this.emit("error",t)},o.prototype.doClose=function(){this.controlChannel&&this.emit(this.controlChannel,{type:"Channel Closing",request:"close"}),i.eachProp(this.emits,function(e,t){this.teardown(t)}.bind(this)),this.emit("close"),this.off(),this.emitChannel=null},o.prototype.toString=function(){return this.emitChannel?"[Consumer "+this.emitChannel+"]":"[unbound Consumer]"},o.nextId=function(){return o.id||(o.id=1),o.id+=1},o.messageToPortable=function(e,t,n){var i=[],r=o.conform(e,t,i,!0,n);return{text:r,binary:i}},o.portableToMessage=function(e,t,n){return o.conform(e,t.text,t.binary,!1,n)},o.conform=function(e,t,n,r,s){if("function"==typeof t)return void 0;if("undefined"==typeof t)return void 0;if(null===t)return null;if(void 0===e)return void s.error("Message discarded for not matching declared type!",t);switch(e){case"string":return String("")+t;case"number":return Number(1)*t;case"boolean":return Boolean(t===!0);case"object":return"undefined"==typeof t?void 0:JSON.parse(JSON.stringify(t));case"blob":return r?t instanceof Blob?(n.push(t),n.length-1):(s.error("conform expecting Blob, but saw "+typeof t),n.push(new Blob([])),n.length-1):n[t];case"buffer":return r?(n.push(o.makeArrayBuffer(t,s)),n.length-1):o.makeArrayBuffer(n[t],s);case"proxy":return t}var a,c;if(Array.isArray(e)&&void 0!==t){if(a=[],c=0,2===e.length&&"array"===e[0])for(c=0;c<t.length;c+=1)a.push(o.conform(e[1],t[c],n,r,s));else for(c=0;c<e.length;c+=1)a.push(void 0!==t[c]?o.conform(e[c],t[c],n,r,s):void 0);return a}return"object"==typeof e&&void 0!==t?(a={},i.eachProp(e,function(e,i){void 0!==t[i]&&(a[i]=o.conform(e,t[i],n,r,s))}),a):void s.error("Unknown template provided: "+e)},o.makeArrayBuffer=function(e,t){return e?e instanceof ArrayBuffer?e:"ArrayBuffer"===e.constructor.name&&"undefined"==typeof e.prototype?new DataView(e).buffer:(t.error("expecting ArrayBuffer, but saw "+typeof e+": "+JSON.stringify(e)),new ArrayBuffer(0)):new ArrayBuffer(0)},o.recursiveFreezeObject=function(e){var t,n={};if("object"!=typeof e)return e;for(t in e)e.hasOwnProperty(t)&&Object.defineProperty(n,t,{value:o.recursiveFreezeObject(e[t]),writable:!1,enumerable:!0});return n},t.exports=o},{"./util":35}],21:[function(e,t,n){var i=e("./util"),o=function(e){this.id="debug",this.emitChannel=!1,this.config=!1,i.handleEvents(this)};o.prototype.toString=function(){return"[Console]"},o.prototype.setLogger=function(e){this.logger&&this.info("Replacing Logger."),this.logger=e,this.emit("logger")},o.prototype.onMessage=function(e,t){"control"===e&&t.channel&&!this.emitChannel&&(this.emitChannel=t.channel,this.config=t.config,this.config.global.console||("undefined"!=typeof console?this.config.global.console=console:this.config.global.console=this.getLogger("Console")),this.emit("ready"))},o.prototype.format=function(e,t,n){var i,o,r=[];if("string"==typeof n&&t)try{o=JSON.parse(n),o instanceof Array&&(n=o)}catch(s){}if("string"==typeof n)r.push(n);else for(i=0;i<n.length;i+=1)r.push(n[i]);return this.emitChannel?void this.emit(this.emitChannel,{severity:e,source:t,quiet:!0,request:"debug",msg:JSON.stringify(r)}):void this.on("ready",this.format.bind(this,e,t,r))},o.prototype.print=function(e){if(!this.logger)return void this.once("logger",this.print.bind(this,e));var t,n=[],i=0;if(t=JSON.parse(e.msg),"string"==typeof t)n.push(t);else for(;void 0!==t[i];)n.push(t[i]),i+=1;this.logger[e.severity].call(this.logger,e.source,n,function(){})},o.prototype.log=function(){this.format("log",void 0,arguments)},o.prototype.info=function(){this.format("info",void 0,arguments)},o.prototype.debug=function(){this.format("debug",void 0,arguments)},o.prototype.warn=function(){this.format("warn",void 0,arguments)},o.prototype.error=function(){this.format("error",void 0,arguments)},
o.prototype.getLogger=function(e){var t=function(e,t){var n=Array.prototype.splice.call(arguments,2);this.format(e,t,n)},n={freedom:!0,debug:t.bind(this,"debug",e),info:t.bind(this,"info",e),log:t.bind(this,"log",e),warn:t.bind(this,"warn",e),error:t.bind(this,"error",e)};return n},t.exports=o},{"./util":35}],22:[function(e,t,n){(function(n){var i,o=e("es6-promise").Promise,r=e("./api"),s=e("./debug"),a=e("./hub"),c=e("./manager"),h=e("./policy"),d=e("./proxybinder"),l=e("./resource"),u=e("./util"),p=e("./bundle"),f=function(){"use strict";"undefined"!=typeof n&&void 0===n.prototype?i=n:setTimeout(function(){i=this},0)};f();var g=function(e,t,n){"use strict";var f,g,m,v=new s,y=new a(v),b=new l(v),w=new r(v),C=new c(y,b,w),E=new d(C),S={debug:"log",manifest:t,moduleContext:e&&"undefined"!=typeof e.isModule?e.isModule:u.isModuleContext()},x=function(){w.cleanup(),C.destroy()};return n&&u.mixin(S,n,!0),S.global=i,e&&u.mixin(S,e,!0),e.providers.forEach(function(e){var t;0===e.name.indexOf("core.")&&"function"==typeof e.register&&(t=e.name.substr(5),e.register(n&&n[t]?n[t]:S[t]?S[t]:void 0))}),p.register(e.providers,w),b.register(e.resolvers||[]),new o(function(e,t){if(S.moduleContext)m=S.portType,g=new m("Outbound",b),C.setup(g),C.once("delegate",C.setup.bind(C,v));else{C.setup(v),f=new h(C,b,S);var n,i;n=function(e){w.getCore("core.console",{config:S}).then(function(t){var n=new t.inst;v.setLogger(n),e&&v.error(e)})},i=function(e){return b.get(S.location,e).then(function(e){return f.get([],e)}).then(function(e){return C.setup(e),E.bindDefault(e,w,e.manifest)})},S.logger?i(S.logger).then(function(e){"console"!==e.external.api?n("Unwilling to use logger with unknown API:",e.external.api):v.setLogger(e.external())},n):n(),i(S.manifest).then(function(e){return e.port.once("close",x),e.external},function(e){throw v.error("Failed to retrieve manifest: "+e),e}).then(e,t)}y.emit("config",S)})};t.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./api":18,"./bundle":19,"./debug":21,"./hub":23,"./manager":26,"./policy":29,"./proxybinder":33,"./resource":34,"./util":35,"es6-promise":2}],23:[function(e,t,n){var i=e("./util"),o=function(e){this.debug=e,this.config={},this.apps={},this.routes={},i.handleEvents(this),this.on("config",function(e){i.mixin(this.config,e)}.bind(this))};o.prototype.onMessage=function(e,t){var n,i=this.routes[e];return i&&i.app?this.apps[i.app]?(!t.quiet&&!i.quiet&&this.config&&this.config.trace&&(n=t.type,"message"===t.type&&t.message&&"method"===t.message.action?n="method."+t.message.type:"method"===t.type&&t.message&&"method"===t.message.type?n="return."+t.message.name:"message"===t.type&&t.message&&"event"===t.message.type&&(n="event."+t.message.name),this.debug.debug(this.apps[i.source].toString()+" -"+n+"-> "+this.apps[i.app].toString()+"."+i.flow)),void this.apps[i.app].onMessage(i.flow,t)):void this.debug.warn("Message dropped to destination "+i.app):void this.debug.warn("Message dropped from unregistered source "+e)},o.prototype.getDestination=function(e){var t=this.routes[e];return t?this.apps[t.app]:null},o.prototype.getSource=function(e){return e?this.apps[e.id]?this.apps[e.id]:(this.debug.warn("No registered source '"+e.id+"'"),!1):!1},o.prototype.register=function(e,t){return!this.apps[e.id]||t?(this.apps[e.id]=e,!0):!1},o.prototype.deregister=function(e){return this.apps[e.id]?(delete this.apps[e.id],!0):!1},o.prototype.install=function(e,t,n,i){if(e=this.getSource(e)){if(!t)return void this.debug.warn("Unwilling to generate blackhole flow from "+e.id);var o=this.generateRoute();return this.routes[o]={app:t,flow:n,source:e.id,quiet:i},"function"==typeof e.on&&e.on(o,this.onMessage.bind(this,o)),o}},o.prototype.uninstall=function(e,t){if(e=this.getSource(e)){var n=this.routes[t];return n?n.source!==e.id?(this.debug.warn("Flow "+t+" does not belong to port "+e.id),!1):(delete this.routes[t],"function"==typeof e.off&&e.off(n),!0):!1}},o.prototype.teardown=function(){i.eachProp(this.apps,function(e){"function"==typeof e.off&&e.off()}),this.apps={},this.routes={}},o.prototype.generateRoute=function(){return i.getId()},t.exports=o},{"./util":35}],24:[function(e,t,n){var i=e("./util"),o=function(e,t){this.id="Link"+Math.random(),this.name=e,this.resource=t,this.config={},this.src=null,i.handleEvents(this),i.mixin(this,o.prototype)};o.prototype.onMessage=function(e,t){"control"!==e||this.controlChannel?this.deliverMessage(e,t):!this.controlChannel&&t.channel&&(this.controlChannel=t.channel,i.mixin(this.config,t.config),this.start())},o.prototype.addErrorHandler=function(e){this.onError=e},o.prototype.onError=function(e){},o.prototype.emitMessage=function(e,t){"control"===e&&this.controlChannel&&(e=this.controlChannel),this.emit(e,t)},t.exports=o},{"./util":35}],25:[function(e,t,n){var i=e("../link"),o=function(e,t){i.call(this,e,t),e&&(this.id=e)};o.prototype.start=function(){this.config.moduleContext?this.setupListener():this.setupWorker()},o.prototype.stop=function(){},o.prototype.toString=function(){return"[Worker "+this.id+"]"},o.prototype.setupListener=function(){var e=function(e){this.emitMessage(e.data.flow,e.data.message)}.bind(this);this.obj=this.config.global,this.obj.addEventListener("message",e,!0),this.stop=function(){this.obj.removeEventListener("message",e,!0),delete this.obj},this.emit("started"),this.obj.postMessage("Ready For Messages")},o.prototype.setupWorker=function(){var e;e=new Worker(this.config.source+"#"+this.id),e.addEventListener("error",function(e){this.onError(e)}.bind(this),!0),e.addEventListener("message",function(e,t){return this.obj?void this.emitMessage(t.data.flow,t.data.message):(this.obj=e,void this.emit("started"))}.bind(this,e),!0),this.stop=function(){e.terminate(),this.obj&&delete this.obj}},o.prototype.deliverMessage=function(e,t){"control"===e&&"close"===t.type&&"control"===t.channel?this.stop():this.obj?this.obj.postMessage({flow:e,message:t}):this.once("started",this.onMessage.bind(this,e,t))},t.exports=o},{"../link":24}],26:[function(e,t,n){var i=e("./util"),o=e("./moduleinternal"),r=function(e,t,n){this.id="control",this.config={},this.controlFlows={},this.dataFlows={},this.dataFlows[this.id]=[],this.reverseFlowMap={},this.debug=e.debug,this.hub=e,this.resource=t,this.api=n,this.delegate=null,this.toDelegate={},this.hub.on("config",function(e){i.mixin(this.config,e),this.emit("config")}.bind(this)),i.handleEvents(this),this.hub.register(this)};r.prototype.toString=function(){return"[Local Controller]"},r.prototype.onMessage=function(e,t){var n,i=this.controlFlows[e];if(!i)return void this.debug.warn("Unknown message source: "+e);if(n=this.hub.getDestination(i),this.delegate&&i!==this.delegate&&this.toDelegate[e])return void this.emit(this.delegate,{type:"Delegation",request:"handle",quiet:!0,flow:e,message:t});if("debug"===t.request)return void this.debug.print(t);if("link"===t.request)this.createLink(n,t.name,t.to,t.overrideDest);else if("environment"===t.request)this.createLink(n,t.name,new o(this));else if("delegate"===t.request)null===this.delegate&&(this.delegate=i),this.toDelegate[t.flow]=!0,this.emit("delegate");else if("resource"===t.request)this.resource.addResolver(t.args[0]),this.resource.addRetriever(t.service,t.args[1]);else if("core"===t.request){if(this.core&&i===this.delegate)return void(new this.core).onMessage(n,t.message);this.getCore(function(e,t){this.hub.onMessage(e,{type:"core",core:t})}.bind(this,i))}else if("close"===t.request)this.destroy(n);else{if("unlink"!==t.request)return this.debug.warn("Unknown control request: "+t.request),void this.debug.log(JSON.stringify(t));this.removeLink(n,t.to)}},r.prototype.getPort=function(e){return this.hub.getDestination(this.controlFlows[e])},r.prototype.setup=function(e){if(!e.id)return this.debug.warn("Refusing to setup unidentified port "),!1;if(this.controlFlows[e.id])return this.debug.warn("Refusing to re-initialize port "+e.id),!1;if(!this.config.global)return void this.once("config",this.setup.bind(this,e));this.hub.register(e);var t=this.hub.install(this,e.id,"control"),n=this.hub.install(e,this.id,e.id);return this.controlFlows[e.id]=t,this.dataFlows[e.id]=[n],this.reverseFlowMap[t]=n,this.reverseFlowMap[n]=t,e.lineage&&this.emit("moduleAdd",{id:e.id,lineage:e.lineage}),this.hub.onMessage(t,{type:"setup",channel:n,config:this.config}),!0},r.prototype.destroy=function(e){if(!e)return i.eachProp(this.controlFlows,function(e){this.hub.onMessage(e,{type:"close"})}.bind(this)),void this.hub.teardown();if(!e.id)return this.debug.warn("Unable to tear down unidentified port"),!1;e.lineage&&this.emit("moduleRemove",{id:e.id,lineage:e.lineage}),delete this.controlFlows[e.id];var t;for(t=this.dataFlows[e.id].length-1;t>=0;t-=1)this.removeLink(e,this.dataFlows[e.id][t]);delete this.dataFlows[e.id],this.hub.deregister(e)},r.prototype.createLink=function(e,t,n,i,o){if(!this.config.global)return void this.once("config",this.createLink.bind(this,e,t,n,i));if(!this.controlFlows[e.id])return void this.debug.warn("Unwilling to link from non-registered source.");if(!this.controlFlows[n.id]&&this.setup(n)===!1)return void this.debug.warn("Could not find or setup destination.");var r,s=n.quiet||!1,a=i||"default",c=this.hub.install(e,n.id,a,s);n=this.hub.getDestination(c),r=this.hub.install(n,e.id,t,s),this.reverseFlowMap[c]=r,this.dataFlows[e.id].push(c),this.reverseFlowMap[r]=c,this.dataFlows[n.id].push(r),o?this.hub.onMessage(this.controlFlows[n.id],{type:"createLink",name:a,channel:r,reverse:c}):this.hub.onMessage(this.controlFlows[e.id],{name:t,type:"createLink",channel:c,reverse:r})},r.prototype.removeLink=function(e,t){var n,i=this.hub.getDestination(t),o=this.reverseFlowMap[t];return i&&o?this.hub.getDestination(o).id!==e.id?void this.debug.warn("Source port does not own flow "+t):(n=this.controlFlows[e.id],n&&this.hub.onMessage(n,{type:"close",channel:t}),n=this.controlFlows[i.id],n&&this.hub.onMessage(n,{type:"close",channel:o}),this.hub.uninstall(e,t),this.hub.uninstall(i,o),delete this.reverseFlowMap[t],delete this.reverseFlowMap[o],this.forgetFlow(i.id,o),void this.forgetFlow(e.id,t)):void this.debug.warn("Could not find metadata to remove flow: "+t)},r.prototype.forgetFlow=function(e,t){var n;if(this.dataFlows[e])for(n=0;n<this.dataFlows[e].length;n+=1)if(this.dataFlows[e][n]===t){this.dataFlows[e].splice(n,1);break}},r.prototype.getCore=function(e){this.core?e(this.core):this.api.getCore("core",this).then(function(t){this.core=t.inst,e(this.core)}.bind(this),function(){e(void 0)})},t.exports=r},{"./moduleinternal":28,"./util":35}],27:[function(e,t,n){var i=e("./util"),o=e("./provider"),r=function(e,t,n,o){this.api=o.api,this.policy=o,this.resource=o.resource,this.debug=o.debug,this.config={},this.id=e+Math.random(),this.manifestId=e,this.manifest=t,this.lineage=[this.manifestId].concat(n),this.quiet=this.manifest.quiet||!1,this.externalPortMap={},this.internalPortMap={},this.dependantChannels=[],this.started=!1,i.handleEvents(this)};r.prototype.onMessage=function(e,t){if("control"===e){if("setup"===t.type)return this.controlChannel=t.channel,i.mixin(this.config,t.config),this.emit(this.controlChannel,{type:"Core Provider",request:"core"}),void this.start();if("createLink"===t.type&&t.channel){this.debug.debug(this+"got create link for "+t.name),this.externalPortMap[t.name]=t.channel,void 0===this.internalPortMap[t.name]&&(this.internalPortMap[t.name]=!1);var n={type:"default channel announcement",channel:t.reverse};return this.manifest.dependencies&&this.manifest.dependencies[t.name]&&(n.api=this.manifest.dependencies[t.name].api),void this.emit(t.channel,n)}if(t.core)return this.core=new t.core,void this.emit("core",t.core);"close"===t.type?(t.channel&&"control"!==t.channel||this.stop(),this.deregisterFlow(t.channel,!1)):this.port.onMessage(e,t)}else{if((this.externalPortMap[e]===!1||!this.externalPortMap[e])&&t.channel)return this.debug.debug(this+"handling channel announcement for "+e),this.externalPortMap[e]=t.channel,void(void 0===this.internalPortMap[e]&&(this.internalPortMap[e]=!1,this.manifest.provides&&this.modInternal?this.port.onMessage(this.modInternal,{type:"Connection",channel:e,api:t.api}):this.manifest.provides?this.once("modInternal",function(e,t){this.port.onMessage(this.modInternal,{type:"Connection",channel:e,api:t})}.bind(this,e,t.api)):!this.externalPortMap["default"]&&t.channel&&(this.externalPortMap["default"]=t.channel,this.once("internalChannelReady",function(e){this.internalPortMap[e]=this.internalPortMap["default"]}.bind(this,e)))));if(this.started)if(this.internalPortMap[e]===!1)console.warn("waiting on internal channel for msg"),this.once("internalChannelReady",this.onMessage.bind(this,e,t));else{if(!this.internalPortMap[e])return void this.debug.error("Unexpected message from "+e);this.port.onMessage(this.internalPortMap[e],t)}else this.once("start",this.onMessage.bind(this,e,t))}},r.prototype.deregisterFlow=function(e,t){var n,i=t?this.internalPortMap:this.externalPortMap;for(n in i)if(i[n]===e){t?this.emit(this.controlChannel,{type:"Channel Teardown",request:"unlink",to:this.externalPortMap[n]}):this.port&&this.port.onMessage("control",{type:"close",channel:this.internalPortMap[n]}),delete this.externalPortMap[n],delete this.internalPortMap[n];for(n in this.externalPortMap)if(this.externalPortMap.hasOwnProperty(n)&&this.dependantChannels.indexOf(n)<0)return!0;return this.stop(),!0}return!1},r.prototype.start=function(){var e;return this.started||this.port?!1:void(this.controlChannel&&(this.loadLinks(),e=this.config.portType,this.port=new e(this.manifest.name,this.resource),this.port.on(this.emitMessage.bind(this)),this.port.addErrorHandler(function(e){this.debug.warn("Module Failed",e),this.emit(this.controlChannel,{request:"close"})}.bind(this)),this.port.onMessage("control",{channel:"control",config:this.config}),this.port.onMessage("control",{type:"Redirect",request:"delegate",flow:"debug"}),this.port.onMessage("control",{type:"Redirect",request:"delegate",flow:"core"}),this.port.onMessage("control",{type:"Environment Configuration",request:"environment",name:"ModInternal"})))},r.prototype.stop=function(){this.started&&(this.emit("close"),this.port&&(this.port.off(),this.port.onMessage("control",{type:"close",channel:"control"}),this.port.stop(),delete this.port),delete this.policy,this.started=!1)},r.prototype.toString=function(){return"[Module "+this.manifest.name+"]"},r.prototype.emitMessage=function(e,t){if(this.internalPortMap[e]===!1&&t.channel)return this.internalPortMap[e]=t.channel,void this.emit("internalChannelReady");if("control"===e)if("debug"===t.flow&&t.message)this.debug.format(t.message.severity,t.message.source||this.toString(),t.message.msg);else if("core"===t.flow&&t.message){if(!this.core)return void this.once("core",this.emitMessage.bind(this,e,t));"register"===t.message.type&&(t.message.reply=this.port.onMessage.bind(this.port,"control"),this.externalPortMap[t.message.id]=!1),this.core.onMessage(this,t.message)}else"ModInternal"!==t.name||this.modInternal?"createLink"===t.type?(this.internalPortMap[t.name]=t.channel,this.port.onMessage(t.channel,{type:"channel announcement",channel:t.reverse}),this.emit("internalChannelReady")):"close"===t.type&&this.deregisterFlow(t.channel,!0):(this.modInternal=t.channel,this.port.onMessage(this.modInternal,{type:"Initialization",id:this.manifestId,appId:this.id,manifest:this.manifest,lineage:this.lineage,channel:t.reverse}),this.emit("modInternal"));else"ModInternal"!==e||"ready"!==t.type||this.started?"ModInternal"===e&&"resolve"===t.type?this.resource.get(this.manifestId,t.data).then(function(e,t){this.port.onMessage(this.modInternal,{type:"resolve response",id:e,data:t})}.bind(this,t.id),function(){this.debug.warn("Error Resolving URL for Module.")}.bind(this)):this.emit(this.externalPortMap[e],t):(this.started=!0,this.emit("start"));return!1},r.prototype.loadLinks=function(){var e,t,n,r=["default"];if(this.manifest.permissions)for(e=0;e<this.manifest.permissions.length;e+=1)t=this.manifest.permissions[e],r.indexOf(t)<0&&0===t.indexOf("core.")&&(r.push(t),this.dependantChannels.push(t),n=new o(this.api.get(t).definition,this.debug),this.api.provideCore(t,n,this),this.emit(this.controlChannel,{type:"Core Link to "+t,request:"link",name:t,to:n}));for(this.manifest.dependencies&&i.eachProp(this.manifest.dependencies,function(e,t){r.indexOf(t)<0&&(r.push(t),this.dependantChannels.push(t)),this.resource.get(this.manifestId,e.url).then(function(e){this.policy.get(this.lineage,e).then(function(e){this.updateEnv(t,e.manifest),this.emit(this.controlChannel,{type:"Link to "+t,request:"link",name:t,overrideDest:t+"."+this.id,to:e})}.bind(this),function(e){this.debug.warn("failed to load dep: ",t,e)}.bind(this))}.bind(this),function(e){this.debug.warn("failed to load dep: ",t,e)}.bind(this))}.bind(this)),e=0;e<r.length;e+=1)this.externalPortMap[r[e]]=this.externalPortMap[r[e]]||!1,this.internalPortMap[r[e]]=!1},r.prototype.updateEnv=function(e,t){if(t){if(!this.modInternal)return void this.once("modInternal",this.updateEnv.bind(this,e,t));var n;n={name:t.name,icon:t.icon,description:t.description,api:t.api},this.port.onMessage(this.modInternal,{type:"manifest",name:e,manifest:n})}},t.exports=r},{"./provider":30,"./util":35}],28:[function(e,t,n){var i=e("es6-promise").Promise,o=(e("./proxy/apiInterface"),e("./provider")),r=e("./proxybinder"),s=e("./util"),a=function(e){this.config={},this.manager=e,this.debug=e.debug,this.binder=new r(this.manager),this.api=this.manager.api,this.manifests={},this.providers={},this.id="ModuleInternal",this.pendingPorts=0,this.requests={},s.handleEvents(this)};a.prototype.onMessage=function(e,t){if("control"===e)!this.controlChannel&&t.channel&&(this.controlChannel=t.channel,s.mixin(this.config,t.config));else if("default"!==e||this.appId)"default"===e&&this.requests[t.id]?(this.requests[t.id](t.data),delete this.requests[t.id]):"default"===e&&"manifest"===t.type?(this.emit("manifest",t),this.updateManifest(t.name,t.manifest)):"default"===e&&"Connection"===t.type&&(t.api&&this.providers[t.api]?this.manager.createLink(this.providers[t.api],t.channel,this.port,t.channel):!this.defaultPort||t.api!==this.defaultPort.api&&t.api?this.once("start",this.onMessage.bind(this,e,t)):this.manager.createLink(this.defaultPort,t.channel,this.port,t.channel));else{this.port=this.manager.hub.getDestination(t.channel),this.externalChannel=t.channel,this.appId=t.appId,this.lineage=t.lineage;var n=this.mapProxies(t.manifest);this.generateEnv(t.manifest,n).then(function(){return this.loadLinks(n)}.bind(this)).then(this.loadScripts.bind(this,t.id,t.manifest.app.script)).then(null,function(e){this.debug.error("Could not set up module "+this.appId+": ",e)}.bind(this))}},a.prototype.toString=function(){return"[Environment Helper]"},a.prototype.generateEnv=function(e,t){return this.binder.bindDefault(this.port,this.api,e,!0).then(function(e){var n=0;if(e.port.api=e.external.api,this.defaultPort=e.port,e.external.api)for(n=0;n<t.length;n+=1)if(t[n].name===e.external.api&&t[n].def.provides){t.splice(n,1);break}this.config.global.freedom=e.external}.bind(this))},a.prototype.attach=function(e,t,n){var i=this.config.global.freedom;t&&(this.providers[e]=n.port),i[e]||(i[e]=n.external,this.manifests[e]&&(i[e].manifest=this.manifests[e])),this.pendingPorts-=1,0===this.pendingPorts&&this.emit("start")},a.prototype.loadLinks=function(e){var t,n,r,a=function(e,t,n){return"manifest"===t&&n.name===e},c=function(e,t){var n={name:e.api};t.manifest.api&&t.manifest.api[e.api]?n.definition=t.manifest.api[e.api]:n.definition=null,this.binder.getExternal(this.port,e.name,n).then(this.attach.bind(this,e.name,!1))}.bind(this),h=new i(function(e,t){this.once("start",e)}.bind(this));for(t=0;t<e.length;t+=1)e[t].api&&!e[t].def?this.manifests[e[t].name]?c(e[t],{manifest:this.manifests[e[t].name]}):this.once(a.bind({},e[t].name),c.bind(this,e[t])):this.binder.getExternal(this.port,e[t].name,e[t].def).then(this.attach.bind(this,e[t].name,e[t].def&&e[t].def.provides)),this.pendingPorts+=1;return this.manager.resource.addResolver(function(e,t,n){var i=s.getId();return this.requests[i]=n,this.emit(this.externalChannel,{type:"resolve",id:i,data:t}),!0}.bind(this)),this.pendingPorts+=1,r=this.api.get("core").definition,n=new o(r,this.debug),this.manager.getCore(function(e){new e(this.manager).setId(this.lineage),n.getInterface().provideAsynchronous(e)}.bind(this)),this.emit(this.controlChannel,{type:"Link to core",request:"link",name:"core",to:n}),this.binder.getExternal(n,"default",{name:"core",definition:r}).then(this.attach.bind(this,"core",!1)),0===this.pendingPorts&&this.emit("start"),h},a.prototype.updateManifest=function(e,t){var n=this.config.global.freedom;n&&n[e]?n[e].manifest=t:this.manifests[e]=t},a.prototype.mapProxies=function(e){var t,n,i=[],o=["core"];if(e.permissions)for(t=0;t<e.permissions.length;t+=1)n={name:e.permissions[t],def:void 0},n.def=this.api.get(n.name),o.indexOf(n.name)<0&&n.def&&(i.push(n),o.push(n.name));if(e.dependencies&&s.eachProp(e.dependencies,function(e,t){n={name:t,api:e.api},o.indexOf(t)<0&&(e.api&&(n.def=this.api.get(e.api)),i.push(n),o.push(t))}.bind(this)),e.provides)for(t=0;t<e.provides.length;t+=1){if(n={name:e.provides[t],def:void 0},n.def=this.api.get(n.name),n.def)n.def.provides=!0;else{if(!e.api||!e.api[n.name]){this.debug.warn('Module will not provide "'+n.name+'", since no declaration can be found.');continue}n.def={name:n.name,definition:e.api[n.name],provides:!0}}o.indexOf(n.name)<0&&(i.push(n),o.push(n.name))}return i},a.prototype.loadScripts=function(e,t){var n,i,o=function(e,t,n){try{this.config.global.importScripts(e),t(!0)}catch(i){n(i)}}.bind(this);n="string"==typeof t?1:t.length,i=function(r){if(r===n)return void this.emit(this.externalChannel,{type:"ready"});var s;s="string"==typeof t?t:t[r],this.manager.resource.get(e,s).then(function(e){this.tryLoad(o,e).then(function(){i(r+1)}.bind(this))}.bind(this))}.bind(this),this.config.global.importScripts||(o=function(e,t,n){var i=this.config.global.document.createElement("script");i.src=e,i.addEventListener("load",t,!0),this.config.global.document.body.appendChild(i)}.bind(this)),i(0)},a.prototype.tryLoad=function(e,t){return new i(e.bind({},t)).then(function(e){return e},function(e){this.debug.warn(e.stack),this.debug.error("Error loading "+t,e),this.debug.error("If the stack trace is not useful, see https://github.com/freedomjs/freedom/wiki/Debugging-Script-Parse-Errors")}.bind(this))},t.exports=a},{"./provider":30,"./proxy/apiInterface":31,"./proxybinder":33,"./util":35,"es6-promise":2}],29:[function(e,t,n){var i=e("es6-promise").Promise,o=e("./module"),r=e("./util"),s=function(e,t,n){this.api=e.api,this.debug=e.debug,this.location=n.location,this.resource=t,this.config=n,this.runtimes=[],this.policies=[],this.pending={},r.handleEvents(this),this.add(e,n.policy),this.runtimes[0].local=!0};s.prototype.defaultPolicy={background:!1,interactive:!0},s.prototype.defaultConstraints={isolation:"always",placement:"local"},s.prototype.get=function(e,t){return this.pending[t]?new i(function(n,i){this.once("placed",function(e,t){this.get(e,t).then(n,i)}.bind(this,e,t))}.bind(this)):(this.pending[t]=!0,this.loadManifest(t).then(function(n){var i,r=this.overlay(this.defaultConstraints,n.constraints),s=this.findDestination(e,t,r);return s.local?(i=this.isRunning(s,t,e,"never"!==r.isolation),"always"!==r.isolation&&i?(this.debug.info("Reused port "+i),delete this.pending[t],this.emit("placed"),s.manager.getPort(i)):new o(t,n,e,this)):(this.debug.error("Unexpected location selected for module placement"),!1)}.bind(this),function(e){throw this.debug.error("Policy Error Resolving "+t,e),e}.bind(this)))},s.prototype.findDestination=function(e,t,n){var i;if("always"!==n.isolation)for(i=0;i<this.policies.length;i+=1)if(this.isRunning(this.runtimes[i],t,e,"never"!==n.isolation))return this.runtimes[i];if("local"===n.placement)return this.runtimes[0];if("stable"===n.placement)for(i=0;i<this.policies.length;i+=1)if(this.policies[i].background)return this.runtimes[i];return this.runtimes[0]},s.prototype.isRunning=function(e,t,n,i){var o,r=0,s=0;for(r=0;r<e.modules.length;r+=1)if(i&&e.modules[r].length===n.length+1){for(o=!0,s=0;s<n.length;s+=1)if(0!==e.modules[r][s+1].indexOf(n[s])){o=!1;break}if(0!==e.modules[r][0].indexOf(t)&&(o=!1),o)return e.modules[r][0]}else if(!i&&0===e.modules[r][0].indexOf(t))return e.modules[r][0];return!1},s.prototype.loadManifest=function(e){return this.resource.getContents(e).then(function(t){try{return JSON.parse(t)}catch(n){throw this.debug.error("Failed to load "+e+": "+n),new Error("No Manifest Available")}}.bind(this))},s.prototype.add=function(e,t){var n={manager:e,modules:[]};this.runtimes.push(n),this.policies.push(this.overlay(this.defaultPolicy,t)),e.on("moduleAdd",function(e,t){var n=[];n=n.concat(t.lineage),n[0]=t.id,e.modules.push(n),this.pending[t.lineage[0]]&&(delete this.pending[t.lineage[0]],this.emit("placed"))}.bind(this,n)),e.on("moduleRemove",function(e,t){var n,i,o=[];for(o=o.concat(t.lineage),o[0]=t.id,i=o.toString(),n=0;n<e.modules.length;n+=1)if(e.modules[n].toString()===i)return void e.modules.splice(n,1);this.debug.warn("Unknown module to remove: ",t.id)}.bind(this,n))},s.prototype.overlay=function(e,t){var n={};return r.mixin(n,e),t&&r.mixin(n,t,!0),n},t.exports=s},{"./module":27,"./util":35,"es6-promise":2}],30:[function(e,t,n){var i=e("./consumer"),o=e("./util"),r=function(e,t){this.id=i.nextId(),o.handleEvents(this),this.debug=t,this.definition=e,this.mode=r.mode.synchronous,this.channels={},this.iface=null,this.closeHandlers={},this.providerCls=null,this.ifaces={},this.emits={}};r.mode={synchronous:0,asynchronous:1,promises:2},r.prototype.onMessage=function(e,t){if("control"===e&&t.reverse)this.channels[t.name]=t.channel,this.emit(t.channel,{type:"channel announcement",channel:t.reverse}),this.emit("start");else if("control"===e&&"setup"===t.type)this.controlChannel=t.channel;else if("control"===e&&"close"===t.type)t.channel===this.controlChannel&&delete this.controlChannel,this.close();else{if(!this.channels[e]&&t.channel)return this.channels[e]=t.channel,void this.emit("start");if(!this.channels[e])return void this.debug.warn("Message from unconfigured source: "+e);if("close"===t.type&&t.to)this.teardown(e,t.to);else if(t.to&&this.emits[e]&&this.emits[e][t.to])t.message.to=t.to,this.emits[e][t.to](t.message);else if(t.to&&t.message&&"construct"===t.message.type){var n,o=i.portableToMessage(this.definition.constructor&&this.definition.constructor.value?this.definition.constructor.value:[],t.message,this.debug);this.ifaces[e]||(this.ifaces[e]={},this.emits[e]={}),this.ifaces[e][t.to]=!0,n=this.getProvider(e,t.to,o),this.ifaces[e]&&this.ifaces[e][t.to]&&(this.ifaces[e][t.to]=n.instance,this.emits[e][t.to]=n.onmsg)}else this.debug.warn(this.toString()+" dropping message "+JSON.stringify(t))}},r.prototype.close=function(){this.controlChannel&&(this.emit(this.controlChannel,{type:"Provider Closing",request:"close"}),delete this.controlChannel),this.emit("close"),delete this.iface,delete this.providerCls,this.ifaces={},this.emits={},this.emitChannel=null},r.prototype.teardown=function(e,t){this.ifaces[e]&&(delete this.ifaces[e][t],delete this.emits[e][t],this.closeHandlers[e]&&this.closeHandlers[e][t]&&(o.eachProp(this.closeHandlers[e][t],function(e){e()}),delete this.closeHandlers[e][t]))},r.prototype.getInterface=function(){return this.iface?this.iface:(this.iface={provideSynchronous:function(e){this.providerCls=e,this.mode=r.mode.synchronous}.bind(this),provideAsynchronous:function(e){this.providerCls=e,this.mode=r.mode.asynchronous}.bind(this),providePromises:function(e){this.providerCls=e,this.mode=r.mode.promises}.bind(this)},o.eachProp(this.definition,function(e,t){switch(e.type){case"constant":Object.defineProperty(this.iface,t,{value:i.recursiveFreezeObject(e.value),writable:!1})}}.bind(this)),this.iface)},r.prototype.getProxyInterface=function(){var e=function(e){return e.getInterface()}.bind({},this);return e.close=function(e){e?o.eachProp(this.ifaces,function(t,n){o.eachProp(t,function(t,i){return t===e?(this.teardown(n,i),this.emit(this.channels[n],{type:"close",to:i}),!0):void 0}.bind(this))}.bind(this)):this.close()}.bind(this),e.onClose=function(e,t){return"function"==typeof e&&void 0===t?void this.once("close",e):void o.eachProp(this.ifaces,function(n,i){o.eachProp(n,function(n,o){return n===e?(this.closeHandlers[i]||(this.closeHandlers[i]={}),this.closeHandlers[i][o]||(this.closeHandlers[i][o]=[]),this.closeHandlers[i][o].push(t),!0):void 0}.bind(this))}.bind(this))}.bind(this),e},r.prototype.getProvider=function(e,t,n){if(!this.providerCls)return this.debug.error("Cannot instantiate provider, since it is not provided"),{instance:void 0,onmsg:void 0};var s,a,c,h={};return o.eachProp(this.definition,function(e,t){"event"===e.type&&(h[t]=e)}),s=function(e,t,n,o,r){if(t[o]){var s=i.messageToPortable(t[o].value,r,this.debug);this.emit(this.channels[e],{type:"message",to:n,message:{name:o,type:"event",text:s.text,binary:s.binary}})}}.bind(this,e,h,t),a=this.providerCls.bind.apply(this.providerCls,[this.providerCls,s].concat(n||[])),c=new a,{instance:c,onmsg:function(e,t,n){if("method"===n.action){if("function"!=typeof this[n.type])return e.debug.warn("Provider does not implement "+n.type+"()!"),void e.emit(e.channels[t],{type:"method",to:n.to,message:{to:n.to,type:"method",reqId:n.reqId,name:n.type,error:"Provider does not implement "+n.type+"()!"}});var o,s=e.definition[n.type],a=e.debug,h=i.portableToMessage(s.value,n,a),d=function(e,t,n,o,r){var s=i.messageToPortable(n.ret,o,a);this.emit(this.channels[e],{type:"method",to:t.to,message:{to:t.to,type:"method",reqId:t.reqId,name:t.type,text:s.text,binary:s.binary,error:r}})}.bind(e,t,n,s);if(Array.isArray(h)||(h=[h]),e.mode===r.mode.synchronous)try{d(this[n.type].apply(this,h))}catch(l){d(void 0,l.message+" "+l.stack)}else if(e.mode===r.mode.asynchronous)try{this[n.type].apply(c,h.concat(d))}catch(u){d(void 0,u.message+" "+u.stack)}else if(e.mode===r.mode.promises)try{o=this[n.type].apply(this,h),o&&o.then?o.then(d,d.bind({},void 0)):d(void 0,"No promise returned from "+n.type+": "+o)}catch(p){d(void 0,p.message+" "+p.stack)}}}.bind(c,this,e)}},r.prototype.toString=function(){return this.emitChannel?"[Provider "+this.emitChannel+"]":"[unbound Provider]"},t.exports=r},{"./consumer":20,"./util":35}],31:[function(e,t,n){var i=e("es6-promise").Promise,o=e("../util"),r=e("../consumer"),s=function(e,t,n,s){var a={},c=null,h=null,d=0,l=arguments;o.eachProp(e,function(e,t){switch(e.type){case"method":this[t]=function(){var o=d,c=new i(function(t,n){a[o]={resolve:t,reject:n,template:e.ret}}),h=r.messageToPortable(e.value,Array.prototype.slice.call(arguments,0),s);return d+=1,n({action:"method",type:t,reqId:o,text:h.text,binary:h.binary}),c};break;case"event":c||(o.handleEvents(this),h=this.emit,delete this.emit,c={}),c[t]=e;break;case"constant":Object.defineProperty(this,t,{value:r.recursiveFreezeObject(e.value),writable:!1})}}.bind(this)),t(this,function(e,t){if("close"===e)return this.off&&this.off(),o.eachProp(a,function(e){e.reject("closed")}),void(a={});if(t)if("method"===t.type)if(a[t.reqId]){var n=a[t.reqId],i=n.template;delete a[t.reqId],t.error?n.reject(t.error):n.resolve(r.portableToMessage(i,t,s))}else s.error("Incoming message claimed to be an RPC returning for unregistered call",t.reqId);else"event"===t.type&&c[t.name]&&h(t.name,r.portableToMessage(c[t.name].value,t,s))}.bind(this)),l=r.messageToPortable(e.constructor&&e.constructor.value?e.constructor.value:[],Array.prototype.slice.call(l,4),s),n({type:"construct",text:l.text,binary:l.binary})};t.exports=s},{"../consumer":20,"../util":35,"es6-promise":2}],32:[function(e,t,n){var i=e("../util"),o=function(e,t,n){i.handleEvents(this),e(this,function(e,t,n){"close"!==t&&e(n.type,n.message);
}.bind(this,this.emit)),this.emit=function(e,t,n){e({type:t,message:n},!0)}.bind({},t)};t.exports=o},{"../util":35}],33:[function(e,t,n){var i=e("es6-promise").Promise,o=e("./proxy/apiInterface"),r=e("./proxy/eventInterface"),s=e("./consumer"),a=e("./provider"),c=function(e){"use strict";this.manager=e};c.prototype.getExternal=function(e,t,n){"use strict";var c,h;return new i(function(i,d){n?(h=n.name,c=n.provides?new a(n.definition,this.manager.debug):new s(o.bind({},n.definition),this.manager.debug)):c=new s(r,this.manager.debug),c.once("start",function(){var e=c.getProxyInterface();h&&(e.api=h),i({port:c,external:e})}),this.manager.createLink(e,t,c)}.bind(this))},c.prototype.bindDefault=function(e,t,n,i){"use strict";var o,r={name:n.name,icon:n.icon,description:n.description};return n["default"]&&(o=t.get(n["default"]),!o&&n.api&&n.api[n["default"]]&&(o={name:n["default"],definition:n.api[n["default"]]}),i&&n.provides&&n.provides.indexOf(n["default"])!==!1?o.provides=!0:i&&t.debug.warn("default API not provided, are you missing a provides key in your manifest?")),this.getExternal(e,"default",o).then(function(e,t){return t.external.manifest=e,t}.bind(this,r))},t.exports=c},{"./consumer":20,"./provider":30,"./proxy/apiInterface":31,"./proxy/eventInterface":32,"es6-promise":2}],34:[function(e,t,n){var i=e("es6-promise").Promise,o=e("./util"),r=function(e){this.debug=e,this.files={},this.resolvers=[this.httpResolver,this.nullResolver],this.contentRetrievers={http:this.xhrRetriever,https:this.xhrRetriever,"chrome-extension":this.xhrRetriever,resource:this.xhrRetriever,chrome:this.xhrRetriever,app:this.xhrRetriever,manifest:this.manifestRetriever}};r.prototype.get=function(e,t){var n=JSON.stringify([e,t]);return new i(function(i,o){this.files[n]?i(this.files[n]):this.resolve(e,t).then(function(e,t,n){this.files[e]=n,t(n)}.bind(this,n,i),o)}.bind(this))},r.prototype.getContents=function(e){return new i(function(t,n){var i;if(!e)return this.debug.warn("Asked to get contents of undefined URL."),n();for(i in this.contentRetrievers)if(this.contentRetrievers.hasOwnProperty(i)){if(0===e.indexOf(i+"://"))return this.contentRetrievers[i].call(this,e,t,n);if(-1===e.indexOf("://")&&"null"===i)return this.contentRetrievers[i].call(this,e,t,n)}n()}.bind(this))};var s=function(e){return new i(function(t,n){var i=[];e.forEach(function(o){o.then(t,function(t){i.push(t),i.length===e.length&&n(i)})})})};r.prototype.resolve=function(e,t){return new i(function(n,r){var a=[];return void 0===t?r():(o.eachReverse(this.resolvers,function(n){a.push(new i(n.bind({},e,t)))}.bind(this)),void s(a).then(n,function(){r("No resolvers to handle url: "+JSON.stringify([e,t]))}))}.bind(this))},r.prototype.addResolver=function(e){this.resolvers.push(e)},r.prototype.addRetriever=function(e,t){return this.contentRetrievers[e]?void this.debug.warn("Unwilling to override file retrieval for "+e):void(this.contentRetrievers[e]=t)},r.prototype.register=function(e){e.length&&e.forEach(function(e){e.resolver?this.addResolver(e.resolver):e.proto&&e.retriever&&this.addRetriever(e.proto,e.retriever)}.bind(this))},r.hasScheme=function(e,t){var n;for(n=0;n<e.length;n+=1)if(0===t.indexOf(e[n]+"://"))return!0;return!1},r.removeRelativePath=function(e){var t,n,i,o=e.indexOf("://")+3;for(e=e.replace(/\/\.\//g,"/");"/"===e.charAt(o);)e=e.slice(0,o)+e.slice(o+1,e.length);for(o=e.indexOf("/",o),t=e.substr(o+1).split("/");-1!==t.indexOf("..");)n=t.indexOf(".."),0===n?t.shift():t.splice(n-1,2);for(i=e.substr(0,o),o=0;o<t.length;o+=1)i+="/"+t[o];return i},r.prototype.httpResolver=function(e,t,n,i){var o,s,a,c,h,d=["http","https","chrome","chrome-extension","resource","app"];return r.hasScheme(d,t)?(n(r.removeRelativePath(t)),!0):e?r.hasScheme(d,e)&&-1===t.indexOf("://")?(o=e.substr(0,e.lastIndexOf("/")),s=o.indexOf("://"),a=s+3+o.substr(s+3).indexOf("/"),c=o.substr(a),h=o.substr(0,a),n(0===t.indexOf("/")?r.removeRelativePath(h+t):r.removeRelativePath(h+c+"/"+t)),!0):void i():(i(),!1)},r.prototype.nullResolver=function(e,t,n,i){var o=["manifest"];return r.hasScheme(o,t)?(n(t),!0):0===t.indexOf("data:")?(n(t),!0):void i()},r.prototype.manifestRetriever=function(e,t,n){var i;try{i=e.substr(11),JSON.parse(i),t(i)}catch(o){this.debug.warn("Invalid manifest URL referenced:"+e),n()}},r.prototype.xhrRetriever=function(e,t,n){var i=new XMLHttpRequest;i.addEventListener("readystatechange",function(t,n){4===i.readyState&&i.responseText?t(i.responseText):4===i.readyState&&(this.debug.warn("Failed to load file "+e+": "+i.status),n(i.status))}.bind(this,t,n),!1),i.overrideMimeType("application/json"),i.open("GET",e,!0),i.send()},t.exports=r},{"./util":35,"es6-promise":2}],35:[function(e,t,n){var i={};i.eachReverse=function(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}},i.hasProp=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.eachProp=function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break},i.mixin=function(e,t,n){return t&&i.eachProp(t,function(t,o){(n||!i.hasProp(e,o))&&(e[o]=t)}),e},i.getId=function(){var e,t="guid",n=12;if("object"==typeof crypto&&crypto.getRandomValues)e=new Uint8Array(n),crypto.getRandomValues(e),i.eachReverse(e,function(e){t+="-"+e});else if("object"==typeof crypto&&crypto.randomBytes)e=crypto.randomBytes(n),i.eachReverse(e,function(e){t+="-"+e});else for(;n>0;)t+="-"+Math.ceil(255*Math.random()),n-=1;return t},i.str2ab=function(e){var t,n=e.length,i=new ArrayBuffer(2*n),o=new Uint16Array(i);for(t=0;n>t;t+=1)o[t]=e.charCodeAt(t);return i},i.ab2str=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},i.handleEvents=function(e){var t,n,i={DEBUG_BACKREF:e,multiple:{},maybemultiple:[],single:{},maybesingle:[]};t=function(e,t){var n,i=[];if(!e||!e.length)return[];for(n=e.length-1;n>=0;n-=1)t(e[n])&&i.push(e.splice(n,1));return i},n=function(e,t,n){"function"==typeof t?this["maybe"+e].push([t,n]):this[e][t]?this[e][t].push(n):this[e][t]=[n]},e.on=n.bind(i,"multiple"),e.once=n.bind(i,"single"),e.emit=function(e,t){var n,i;for(n=0;this.multiple[e]&&n<this.multiple[e].length;n+=1)if(this.multiple[e][n](t)===!1)return;if(this.single[e])for(i=this.single[e],this.single[e]=[],n=0;n<i.length;n+=1)i[n](t);for(n=0;n<this.maybemultiple.length;n+=1)this.maybemultiple[n][0](e,t)&&this.maybemultiple[n][1](t);for(n=this.maybesingle.length-1;n>=0;n-=1)this.maybesingle[n][0](e,t)&&(i=this.maybesingle.splice(n,1),i[0][1](t))}.bind(i),e.off=function(e,n){return e?("function"==typeof e&&(t(this.maybesingle,function(t){return t[0]===e&&(!n||t[1]===n)}),t(this.maybemultiple,function(t){return t[0]===e&&(!n||t[1]===n)})),void(n?(t(this.multiple[e],function(e){return e===n}),t(this.single[e],function(e){return e===n})):(delete this.multiple[e],delete this.single[e]))):(delete this.DEBUG_BACKREF,this.multiple={},this.maybemultiple=[],this.single={},void(this.maybesingle=[]))}.bind(i)},i.isModuleContext=function(){return"undefined"==typeof document},i.getBlob=function(e,t){if("function"!=typeof Blob&&"undefined"!=typeof WebKitBlobBuilder){var n=new WebKitBlobBuilder;return n.append(e),n.getBlob(t)}return new Blob([e],{type:t})},i.scripts=function(e){return e.document.getElementsByTagName("script")},t.exports=i},{}],36:[function(e,t,n){(function(t){function n(){"use strict";var e;return window.document.currentScript?e=window.document.currentScript.src:"complete"!==document.readyState&&"loaded"!==document.readyState?(e=window.document.getElementsByTagName("script"),e=e[e.length-1].src):(e=document.querySelector("script[src*='freedom-ffd405df49d4645338c32a4be1909723.js'],script[src*='freedom-']"),1!==e.length&&console.error("Could not determine freedom-ffd405df49d4645338c32a4be1909723.js script tag."),e=e[0].src),e}var i=[e("../../providers/core/core.unprivileged"),e("../../providers/core/core.echo"),e("../../providers/core/core.console"),e("../../providers/core/core.peerconnection"),e("../../providers/core/core.rtcpeerconnection"),e("../../providers/core/core.rtcdatachannel"),e("../../providers/core/core.storage"),e("../../providers/core/core.view"),e("../../providers/core/core.oauth"),e("../../providers/core/core.websocket"),e("../../providers/core/core.xhr")];"undefined"!=typeof window?window.freedom=e("../entry").bind({},{location:window.location.href,portType:e("../link/worker"),source:n(),providers:i,oauth:[e("../../providers/oauth/oauth.localpageauth"),e("../../providers/oauth/oauth.remotepageauth")]}):e("../entry")({isModule:!0,portType:e("../link/worker"),providers:i,global:t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../providers/core/core.console":5,"../../providers/core/core.echo":6,"../../providers/core/core.oauth":7,"../../providers/core/core.peerconnection":8,"../../providers/core/core.rtcdatachannel":9,"../../providers/core/core.rtcpeerconnection":10,"../../providers/core/core.storage":11,"../../providers/core/core.unprivileged":12,"../../providers/core/core.view":13,"../../providers/core/core.websocket":14,"../../providers/core/core.xhr":15,"../../providers/oauth/oauth.localpageauth":16,"../../providers/oauth/oauth.remotepageauth":17,"../entry":22,"../link/worker":25}]},{},[36]);